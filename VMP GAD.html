<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>POLIC√çA LOCAL ALICANTE - VMP</title>
    <style>
        :root {
            --police-blue: #0a2e52;
            --police-light: #1c4e80;
            --accent: #ffd700;
            --danger: #dc3545;
            --success: #28a745;
            --white: #ffffff;
            --bg: #f4f6f9;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 0;
            /* ESTRUCTURA DE 3 BLOQUES: CABECERA - CONTENIDO - PIE */
            display: flex;
            flex-direction: column;
            height: 100dvh; /* 100% de la altura real del m√≥vil */
            overflow: hidden; /* El cuerpo no hace scroll, solo el contenedor central */
        }

        /* --- 1. CABECERA (GRANDE Y VISIBLE) --- */
        header {
            background-color: var(--white);
            color: var(--police-blue);
            width: 100%;
            padding: 10px 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-bottom: 4px solid var(--police-blue);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0; /* No se encoge nunca */
            z-index: 10;
            height: 90px; /* Altura fija suficiente para logos grandes */
        }

        .header-logo { 
            height: 70px; /* Logos grandes recuperados */
            width: auto; 
            object-fit: contain; 
        }
        
        .header-titles { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            text-align: center; 
            flex-grow: 1; 
            padding: 0 5px;
        }
        
        header h1 { 
            margin: 0; 
            font-size: 1.1rem; /* Texto legible */
            font-weight: 900; 
            letter-spacing: 1px; 
            text-transform: uppercase; 
            line-height: 1.1;
            background: linear-gradient(90deg, var(--police-blue), var(--police-light));
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent;
        }
        header h2 { 
            margin: 4px 0 0 0; 
            font-size: 0.75rem; 
            font-weight: 700; 
            color: #555; 
            text-transform: uppercase; 
        }

        /* --- 2. CONTENEDOR CENTRAL (SCROLL AUTOM√ÅTICO) --- */
        .container { 
            flex-grow: 1; /* Ocupa todo el espacio entre cabecera y pie */
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            overflow-y: auto; /* Scroll aqu√≠ si los botones no caben */
            display: flex;
            flex-direction: column;
            justify-content: center; /* Centrar verticalmente si sobra espacio */
        }

        .card { 
            background: var(--white); 
            border-radius: 12px; 
            padding: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            width: 100%;
        }
        
        /* PREGUNTAS Y BOTONES (TAMA√ëO AUMENTADO) */
        .question-header {
            display: flex; justify-content: space-between; align-items: flex-start;
            border-bottom: 3px solid var(--accent); margin-bottom: 20px; padding-bottom: 10px;
        }
        .question-title { 
            color: var(--police-blue); 
            font-size: 1.3rem; /* Pregunta m√°s grande */
            font-weight: 700; 
            margin: 0; 
            padding-right: 5px; 
        }
        
        .help-btn-icon {
            background: transparent; border: 2px solid var(--police-light); color: var(--police-light); border-radius: 50%;
            width: 32px; height: 32px; font-weight: bold; font-size: 1.2rem; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; flex-shrink: 0;
        }

        .options-grid { display: flex; flex-direction: column; gap: 15px; /* M√°s espacio entre botones */ }

        button.option-btn { 
            background-color: var(--police-light); 
            color: var(--white); 
            border: none; 
            padding: 18px 20px; /* Botones m√°s gordos */
            border-radius: 10px; 
            font-size: 1.1rem; /* Texto m√°s grande */
            cursor: pointer; 
            transition: 0.2s; 
            text-align: left; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            font-weight: 600; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        button.option-btn:active { background-color: var(--police-blue); transform: scale(0.98); }

        .controls { margin-top: 25px; display: flex; gap: 15px; }
        .btn-control { padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; flex: 1; font-size: 1rem; }
        .btn-back { background-color: #90a4ae; color: #37474f; }
        .btn-reset { background-color: var(--accent); color: #000; }

        /* --- 3. FOOTER (SIEMPRE VISIBLE) --- */
        footer {
            flex-shrink: 0; /* No se encoge */
            background: var(--police-blue); 
            color: white; 
            text-align: center;
            padding: 15px 0; 
            font-size: 0.85rem; 
            font-weight: 600; 
            letter-spacing: 1px; 
            z-index: 10;
            display: flex; 
            justify-content: center; 
            gap: 20px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            padding-bottom: max(15px, env(safe-area-inset-bottom)); /* Ajuste iPhone X */
        }
        .footer-item { opacity: 0.9; }

        /* =========================================
           MODAL RESULTADOS (TU VERSI√ìN PERFECTA)
           ========================================= */
        .modal { 
            display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; 
            background-color: rgba(0,0,0,0.85); align-items: center; justify-content: center; 
            padding: 10px; backdrop-filter: blur(3px); 
        }
        
        .modal-content { 
            background-color: var(--white); border-radius: 12px; width: 100%; max-width: 550px; 
            overflow: hidden; display: flex; flex-direction: column; 
            max-height: 95dvh; /* Nunca m√°s alto que la pantalla */
            animation: slideUp 0.2s ease-out; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .modal-header-strip { 
            padding: 10px; text-align: center; color: white; font-weight: bold; font-size: 1rem; 
            text-transform: uppercase; letter-spacing: 1px; flex-shrink: 0; 
        }
        .header-success { background-color: var(--success); }
        .header-danger { background-color: var(--danger); }
        .header-warning { background-color: #f57f17; }
        .header-help { background-color: var(--police-light); }

        .modal-body { 
            padding: 10px 15px; 
            overflow-y: auto; 
            flex-grow: 1; 
            display: flex; flex-direction: column; 
        }

        /* Elementos reducidos SOLO para el modal (para que quepa todo) */
        .result-top-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; width: 100%; }
        .result-logo-img { height: 45px; width: 45px; object-fit: contain; }
        .result-main-icon { font-size: 3rem; line-height: 1; }
        .result-main-title { text-align: center; font-size: 1.2rem; margin: 0 0 10px 0; color: #333; font-weight: 800; border-bottom: 2px solid #eee; padding-bottom: 5px; }

        .legal-table { width: 100%; border-collapse: collapse; margin-bottom: 5px; font-size: 0.8rem; border: 1px solid #e0e0e0; }
        .legal-table th { text-align: left; padding: 6px; background-color: #f5f7fa; width: 35%; border-bottom: 1px solid #ddd; color: var(--police-blue); }
        .legal-table td { padding: 6px; border-bottom: 1px solid #eee; color: #444; font-weight: 600; }

        .legal-box { 
            padding: 8px; border-radius: 6px; font-size: 0.8rem; line-height: 1.3; 
            text-align: left; margin-top: 5px; margin-bottom: 5px;
        }
        .box-penal { background-color: #ffebee; border-left: 4px solid var(--danger); color: #c62828; }
        .box-admin { background-color: #e8f5e9; border-left: 4px solid var(--success); color: #2e7d32; }
        .box-info { background-color: #e3f2fd; border-left: 4px solid var(--police-blue); color: #0d47a1; }

        /* ZONA FIJA INFERIOR DEL MODAL */
        .modal-fixed-bottom {
            flex-shrink: 0;
            background: #fff;
            border-top: 1px solid #eee;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .btn-soa { 
            display: none; width: 100%; background-color: #d32f2f; color: white; padding: 12px; 
            border: none; border-radius: 6px; font-weight: bold; font-size: 0.95rem; 
            cursor: pointer; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .btn-soa span { margin-right: 5px; }

        .nav-buttons-row { display: flex; gap: 10px; width: 100%; }
        .btn-modal-back { flex: 1; padding: 12px; background: #f0f0f0; border: 1px solid #ccc; border-radius: 6px; font-weight: bold; cursor: pointer; color: #555; }
        .btn-modal-new { flex: 1; padding: 12px; background: var(--police-blue); color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }

        /* --- MODAL INFRACCI√ìN --- */
        #infraction-modal { z-index: 2001; } 
        .infraction-box { background: white; padding: 15px; border-radius: 12px; width: 95%; max-width: 500px; border-top: 6px solid #d32f2f; display: flex; flex-direction: column; max-height: 90dvh; }
        .infraction-title { color: #d32f2f; font-size: 1.1rem; font-weight: 800; margin-bottom: 10px; text-align: center; }
        .inf-toggle-container { display: flex; gap: 5px; margin-bottom: 10px; background: #eee; padding: 3px; border-radius: 6px; }
        .inf-toggle-btn { flex: 1; padding: 8px; border: none; font-weight: bold; font-size: 0.8rem; border-radius: 4px; background: transparent; color: #666; }
        .inf-toggle-btn.active { background: #d32f2f; color: white; }
        .inf-content-scroll { overflow-y: auto; flex-grow: 1; margin-bottom: 10px; }
        .inf-row { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.9rem; border-bottom: 1px dashed #eee; padding-bottom: 3px; }
        .inf-val { font-weight: 800; text-align: right; }
        .inf-text { background: #f9f9f9; padding: 10px; border-radius: 6px; border: 1px solid #ddd; font-family: monospace; font-size: 0.85rem; margin: 10px 0; color: #333; }
        .inf-note { font-size: 0.75rem; color: #666; font-style: italic; background: #fff3e0; padding: 8px; border-radius: 5px; margin-top: 8px; border-left: 3px solid #ff9800; }
        .btn-close-inf { width: 100%; padding: 12px; background: #444; color: white; border: none; border-radius: 6px; font-weight: bold; margin-top: auto; }

    </style>
</head>
<body>

<header>
    <img id="head-logo-left" class="header-logo" alt="Judicial" />
    <div class="header-titles">
        <h1>POLIC√çA LOCAL ALICANTE</h1>
        <h2>CATEGORIZACI√ìN VEH√çCULOS LIGEROS</h2>
    </div>
    <img id="head-logo-right" class="header-logo" alt="GAD" />
</header>

<div class="container">
    <div class="card">
        <div id="question-area"></div>
        <div class="controls">
            <button class="btn-control btn-back" id="btn-back-main" onclick="app.prevStep()">‚¨ÖÔ∏è Atr√°s</button>
            <button class="btn-control btn-reset" onclick="app.resetApp()">Reiniciar üîÑ</button>
        </div>
    </div>
</div>

<footer>
    <span class="footer-item">UNIDAD JUDICIAL ¬© 2026</span>
    <span>|</span>
    <span class="footer-item">GAD ¬© 2026</span>
</footer>

<div id="result-modal" class="modal">
    <div class="modal-content">
        <div id="modal-header-strip" class="modal-header-strip">DICTAMEN T√âCNICO POLICIAL</div>
        
        <div class="modal-body">
            <div class="result-top-row">
                <img id="res-logo-left" class="result-logo-img" alt="Judicial" />
                <span id="res-icon" class="result-main-icon"></span>
                <img id="res-logo-right" class="result-logo-img" alt="GAD" />
            </div>

            <h3 id="res-title" class="result-main-title"></h3>
            
            <table class="legal-table">
                <tr><th>Permiso</th><td id="res-permiso"></td></tr>
                <tr><th>Seguro</th><td id="res-seguro"></td></tr>
                <tr><th>Matr√≠cula/Reg</th><td id="res-matricula"></td></tr>
                <tr><th>Casco</th><td id="res-casco"></td></tr>
            </table>
            
            <div id="res-legal-box" class="legal-box"></div>
        </div>
        
        <div class="modal-fixed-bottom">
            <button id="btn-soa" class="btn-soa" onclick="app.showSoaInfraction()">
                <span>üö®</span> VER INFRACCI√ìN SEGURO (SOA)
            </button>

            <div class="nav-buttons-row">
                <button class="btn-modal-back" onclick="app.closeModal()">üîô Corregir</button>
                <button class="btn-modal-new" onclick="app.resetApp()">üîÑ Nueva</button>
            </div>
        </div>
    </div>
</div>

<div id="help-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header-strip header-help">¬øC√ìMO FUNCIONA?</div>
        <div class="modal-body">
            <ul style="padding-left: 20px; color:#444;">
                <li><strong>Categorizaci√≥n:</strong> Responde a las preguntas t√©cnicas.</li>
                <li><strong>Dictamen:</strong> Ficha policial con requisitos.</li>
                <li><strong>Infracciones:</strong> Usa el bot√≥n ROJO para ver denuncia SOA.</li>
            </ul>
        </div>
        <div class="modal-fixed-bottom">
            <button class="btn-modal-new" style="width:100%" onclick="document.getElementById('help-modal').style.display='none'">ENTENDIDO</button>
        </div>
    </div>
</div>

<div id="infraction-modal" class="modal">
    <div class="infraction-box">
        <div class="infraction-title">BOLET√çN DE DENUNCIA (SOA)</div>
        
        <div class="inf-toggle-container" id="inf-tabs">
            <button class="inf-toggle-btn active" onclick="app.switchInfractionMode('driver')">CONDUCTOR</button>
            <button class="inf-toggle-btn" onclick="app.switchInfractionMode('owner')">TITULAR</button>
        </div>

        <div class="inf-content-scroll">
            <div class="inf-row"><span class="inf-label">Normativa:</span><span class="inf-val">RD Leg 8/2004</span></div>
            <div class="inf-row"><span class="inf-label">Opci√≥n:</span><span id="inf-option" class="inf-val"></span></div>
            <div class="inf-row"><span class="inf-label">Importe:</span><span id="inf-amount" class="inf-val" style="color:#d32f2f;"></span></div>
            <div class="inf-row"><span class="inf-label">Reducido:</span><span id="inf-reduced" class="inf-val" style="color:#28a745;"></span></div>

            <p style="margin-bottom:5px; font-weight:bold; font-size:0.8rem; margin-top:10px;">Hecho Denunciado:</p>
            <div class="inf-text" id="inf-text"></div>
            
            <div id="inf-note" class="inf-note" style="display:none;">
                <b>‚ÑπÔ∏è NOTA VMP LIGERO:</b> La denuncia por defecto es para VMP "Pesado" (>25kg y >14km/h). Si es <b>Ligero</b>, usa Opci√≥n <b>2.1.5P</b> (350‚Ç¨).
            </div>
        </div>

        <button class="btn-close-inf" onclick="document.getElementById('infraction-modal').style.display='none'">CERRAR</button>
    </div>
</div>

<script>
    const LOGO_JUDICIAL = "judicial.png";
    const LOGO_GAD = "logogad.png";

    window.onload = function() {
        document.getElementById('head-logo-left').src = LOGO_JUDICIAL;
        document.getElementById('head-logo-right').src = LOGO_GAD;
        document.getElementById('res-logo-left').src = LOGO_JUDICIAL;
        document.getElementById('res-logo-right').src = LOGO_GAD;
        
        const imgs = document.querySelectorAll('img');
        imgs.forEach(img => img.onerror = function(){ this.style.visibility='hidden'; });

        app.renderStep('start');
    };

    const app = {
        currentSoaData: null, 
        currentMode: 'driver', 

        resultsDB: {
            "r_vmp_legal": {
                title: "VMP (VEH√çCULO MOVILIDAD PERSONAL)", icon: "üõ¥", style: "admin",
                perm: "Ninguno", seg: "OBLIGATORIO (SOA)", mat: "Registro DGT (Chapa/QR)", casco: "Consultar Ordenanza Mun.",
                text: "‚úÖ <b>VMP APTO</b><br>R√©gimen administrativo. Edad m√≠nima seg√∫n Ordenanza Municipal.<br>Requiere Seguro Obligatorio si supera 25kg y 14km/h (Ver bot√≥n Infracci√≥n).<br><b>‚öñÔ∏è V√çA PENAL:</b><br>‚Ä¢ No aplica Art. 379/384 CP salvo conducci√≥n temeraria manifiesta.",
                soa: { 
                    type: "vmp_standard",
                    driver: { opt: "2.1.5N", amount: 800, text: "Circular con el veh√≠culo rese√±ado (VMP >25kg y >14km/h) careciendo del seguro obligatorio de responsabilidad civil." },
                    owner:  { opt: "2.1.5N (Tit)", amount: 610, text: "Incumplir el propietario del veh√≠culo rese√±ado (VMP >25kg y >14km/h) la obligaci√≥n de mantener suscrito el seguro obligatorio (Veh√≠culo sin circular)." }
                }
            },
            "r_epac": {
                title: "BICICLETA EPAC", icon: "üö≤", style: "admin",
                perm: "Ninguno", seg: "No", mat: "No", casco: "Recomendado",
                text: "‚úÖ <b>BICI ASISTIDA</b><br>Tratamiento de bicicleta.",
                soa: null
            },
            "r_ciclo": {
                title: "CICLO", icon: "üö≤", style: "admin",
                perm: "Ninguno", seg: "No", mat: "No", casco: "Consultar Ordenanza Mun.",
                text: "‚úÖ <b>BICICLETA</b><br>Tratamiento de bicicleta.",
                soa: null
            },
            "r_juguete": {
                title: "JUGUETE", icon: "üß∏", style: "info",
                perm: "No", seg: "No", mat: "No", casco: "No",
                text: "‚ÑπÔ∏è <b>USO PEATONAL</b><br>Velocidad < 6 km/h.",
                soa: null
            },
            "r_l1e_a": {
                title: "L1e-A (CICLO MOTOR)", icon: "üõµ", style: "penal",
                perm: "AM / B", seg: "S√≠", mat: "S√ç (Matr√≠cula DGT)", casco: "S√≠",
                text: "‚ö†Ô∏è <b>VEH√çCULO A MOTOR (L1e-A)</b><br>Requiere Matr√≠cula, Seguro y Casco.<br><b>‚öñÔ∏è V√çA PENAL:</b><br>‚Ä¢ <b>Art. 379.2 CP:</b> Si tasa alcohol >0.60 mg/l o bajo influencia drogas.<br>‚Ä¢ <b>Art. 384 CP:</b> Si carece de permiso (nunca obtenido/vigencia).",
                soa: { type: "moped", driver: { opt: "2.1.5A", amount: 1000, text: "Circular con el ciclomotor rese√±ado careciendo del seguro obligatorio." }, owner: { opt: "2.1.1A", amount: 650, text: "Incumplir el propietario del ciclomotor la obligaci√≥n de asegurar." } }
            },
            "r_l1e_b": {
                title: "L1e-B (CICLOMOTOR 2R)", icon: "üõµ", style: "penal",
                perm: "AM / B", seg: "S√≠", mat: "S√ç (Matr√≠cula DGT)", casco: "S√≠",
                text: "‚ö†Ô∏è <b>CICLOMOTOR (L1e-B)</b><br>Supera prestaciones VMP. Veh√≠culo matriculable.<br><b>‚öñÔ∏è V√çA PENAL (Delitos):</b><br>‚Ä¢ <b>Art. 379.2 CP:</b> Alcohol >0.60 mg/l o influencia drogas/t√≥xicos.<br>‚Ä¢ <b>Art. 384 CP:</b> Conducir sin haber obtenido nunca permiso o p√©rdida de vigencia.",
                soa: { type: "moped", driver: { opt: "2.1.5A", amount: 1000, text: "Circular con el ciclomotor rese√±ado careciendo del seguro obligatorio." }, owner: { opt: "2.1.1A", amount: 650, text: "Incumplir el propietario del ciclomotor la obligaci√≥n de asegurar." } }
            },
            "r_l2e": {
                title: "L2e (CICLOMOTOR 3R)", icon: "üõ∫", style: "penal",
                perm: "AM / B", seg: "S√≠", mat: "S√ç (Matr√≠cula DGT)", casco: "S√≠",
                text: "‚ö†Ô∏è <b>CICLOMOTOR 3 RUEDAS</b><br>Veh√≠culo matriculable.<br><b>‚öñÔ∏è V√çA PENAL:</b><br>‚Ä¢ <b>Art. 379.2 CP:</b> Alcohol >0.60 mg/l o influencia drogas.<br>‚Ä¢ <b>Art. 384 CP:</b> Carecer de permiso AM.",
                soa: { type: "moped", driver: { opt: "2.1.5A", amount: 1000, text: "Circular con el ciclomotor rese√±ado careciendo del seguro obligatorio." }, owner: { opt: "2.1.1A", amount: 650, text: "Incumplir el propietario del ciclomotor la obligaci√≥n de asegurar." } }
            },
            "r_l6e": {
                title: "L6e (CUADRICICLO LIGERO)", icon: "üöô", style: "penal",
                perm: "AM / B", seg: "S√≠", mat: "S√ç (Matr√≠cula DGT)", casco: "S√≠/Cintur√≥n",
                text: "‚ö†Ô∏è <b>CUADRICICLO LIGERO</b><br>Veh√≠culo matriculable.<br><b>‚öñÔ∏è V√çA PENAL:</b><br>‚Ä¢ <b>Art. 379.2 CP:</b> Alcohol >0.60 mg/l o influencia drogas.<br>‚Ä¢ <b>Art. 384 CP:</b> Carecer de permiso AM.",
                soa: { type: "moped", driver: { opt: "2.1.5A", amount: 1000, text: "Circular con el ciclomotor rese√±ado careciendo del seguro obligatorio." }, owner: { opt: "2.1.1A", amount: 650, text: "Incumplir el propietario del ciclomotor la obligaci√≥n de asegurar." } }
            },
            "r_l3e": {
                title: "L3e (MOTOCICLETA)", icon: "üèçÔ∏è", style: "penal",
                perm: "A1 / A2 / A", seg: "S√≠", mat: "S√ç (Matr√≠cula DGT)", casco: "S√≠",
                text: "‚ö†Ô∏è <b>MOTOCICLETA (L3e)</b><br>Excede prestaciones ciclomotor.<br><b>‚öñÔ∏è V√çA PENAL:</b><br>‚Ä¢ <b>Art. 379.2 CP:</b> Alcohol >0.60 mg/l o influencia drogas.<br>‚Ä¢ <b>Art. 384 CP:</b> Carecer de permiso A1/A2/A (o B+3 a√±os si no cubre potencia).",
                soa: { type: "moto", driver: { opt: "2.1.5B", amount: 1250, text: "Circular con la motocicleta rese√±ada careciendo del seguro obligatorio." }, owner: { opt: "2.1.1B", amount: 850, text: "Incumplir el propietario de la motocicleta la obligaci√≥n de asegurar." } }
            },
            "r_l4e": {
                title: "L4e (MOTO CON SIDECAR)", icon: "üèçÔ∏è", style: "penal",
                perm: "A1 / A2 / A", seg: "S√≠", mat: "S√ç (Matr√≠cula DGT)", casco: "S√≠",
                text: "‚ö†Ô∏è <b>MOTO CON SIDECAR</b><br>Tratamiento de Motocicleta.<br><b>‚öñÔ∏è V√çA PENAL:</b><br>‚Ä¢ Aplica Art. 379.2 CP (Alcohol/Drogas) y Art. 384 CP (Permiso).",
                soa: { type: "moto", driver: { opt: "2.1.5B", amount: 1250, text: "Circular con la motocicleta rese√±ada careciendo del seguro obligatorio." }, owner: { opt: "2.1.1B", amount: 850, text: "Incumplir el propietario de la motocicleta la obligaci√≥n de asegurar." } }
            },
            "r_l5e": {
                title: "L5e (TRICICLO DE MOTOR)", icon: "üõ∫", style: "penal",
                perm: "B (Coche) / A", seg: "S√≠", mat: "S√ç (Matr√≠cula DGT)", casco: "S√≠",
                text: "‚ö†Ô∏è <b>TRICICLO SIM√âTRICO</b><br>Tratamiento de Motocicleta/Turismo.<br><b>‚öñÔ∏è V√çA PENAL:</b><br>‚Ä¢ Aplica Art. 379.2 CP (Alcohol/Drogas) y Art. 384 CP (Permiso).",
                soa: { type: "moto", driver: { opt: "2.1.5B", amount: 1250, text: "Circular con el veh√≠culo rese√±ado careciendo del seguro obligatorio." }, owner: { opt: "2.1.1B", amount: 850, text: "Incumplir el propietario del veh√≠culo la obligaci√≥n de asegurar." } }
            },
            "r_l7e": {
                title: "L7e (CUADRICICLO PESADO)", icon: "üöú", style: "penal",
                perm: "CLASE B", seg: "S√≠", mat: "S√ç (Matr√≠cula DGT)", casco: "S√≠/Cintur√≥n",
                text: "‚ö†Ô∏è <b>CUADRICICLO PESADO</b><br>Requiere permiso Clase B.<br><b>‚öñÔ∏è V√çA PENAL:</b><br>‚Ä¢ Aplica Art. 379.2 CP (Alcohol/Drogas) y Art. 384 CP (Permiso).",
                soa: { type: "turismo", driver: { opt: "2.1.5C", amount: 1500, text: "Circular con el veh√≠culo rese√±ado careciendo del seguro obligatorio." }, owner: { opt: "2.1.1C", amount: 1000, text: "Incumplir el propietario del veh√≠culo la obligaci√≥n de asegurar." } }
            },
            "r_prohibido": {
                title: "PROHIBIDO", icon: "‚õî", style: "danger",
                perm: "-", seg: "-", mat: "-", casco: "-",
                text: "üö´ <b>NO APTO</b><br>No cumple normativa. Denuncia y retirada.",
                soa: null
            },
            "r_prohibido_voltaje": {
                title: "ILEGAL (VOLTAJE)", icon: "üîå", style: "danger",
                perm: "-", seg: "-", mat: "-", casco: "-",
                text: "üö´ <b>VOLTAJE PELIGROSO</b><br>Excede 100VCC / 240VAC.",
                soa: null
            }
        },

        // --- √ÅRBOL DE DECISI√ìN ---
        steps: {
            start: { q: "¬øEl veh√≠culo est√° motorizado?", opts: [{ t: "S√≠", next: "motor_si" }, { t: "No", next: "motor_no" }] },
            motor_no: { q: "¬øFunciona a pedal o manivela?", opts: [{ t: "S√≠", next: "pedal_si" }, { t: "No", result: "r_juguete" }] },
            pedal_si: { q: "¬øCu√°ntas ruedas tiene?", opts: [{ t: "1 rueda", result: "r_prohibido" }, { t: "2 o m√°s ruedas", result: "r_ciclo" }] },
            motor_si: { q: "¬øFunciona con pedales Y el motor es auxiliar?", opts: [{ t: "S√≠ (Pedelec/H√≠brido)", next: "pedales_aux_si" }, { t: "No (Solo acelerador/otro)", next: "pedales_aux_no" }] },
            pedales_aux_si: { q: "¬øCu√°l es la potencia del motor?", opts: [{ t: "Hasta 250 W", next: "potencia_250" }, { t: "Entre 250 W y 1000 W", next: "potencia_1000" }, { t: "M√°s de 1000 W", result: "r_l1e_b" }] },
            potencia_250: { q: "¬øEl motor se detiene al superar 25 km/h?", opts: [{ t: "S√≠", result: "r_epac" }, { t: "No (Sigue asistiendo)", result: "r_l1e_a" }] },
            potencia_1000: { q: "¬øHasta qu√© velocidad auxilia el motor?", opts: [{ t: "Entre 25 y 45 km/h", result: "r_l1e_a" }, { t: "M√°s de 45 km/h", result: "r_l3e" }] },
            pedales_aux_no: { q: "¬øCu√°l es la velocidad m√°xima por construcci√≥n?", opts: [{ t: "Hasta 6 km/h", result: "r_juguete" }, { t: "De 6 a 25 km/h", next: "vel_6_25" }, { t: "De 25 a 45 km/h", next: "vel_hasta_45" }, { t: "M√°s de 45 km/h", next: "vel_mas_45" }] },
            vel_6_25: { q: "Velocidad 6-25 km/h. ¬øTiene sill√≠n?", opts: [{ t: "S√≠", next: "con_sillin_6_25" }, { t: "No", next: "check_baterias" }] },
            con_sillin_6_25: { q: "¬øEs un veh√≠culo autoequilibrado (ej. Segway)?", opts: [{ t: "S√≠", next: "check_baterias" }, { t: "No", next: "check_altura_sillin" }] },
            check_baterias: { q: "¬øQu√© voltaje indican las caracter√≠sticas t√©cnicas?", opts: [{ t: "Hasta 100 VCC / 240 VCA", result: "r_vmp_legal" }, { t: "Superior (Alta Tensi√≥n)", result: "r_prohibido_voltaje" }] },
            vel_hasta_45: { q: "Velocidad 25-45 km/h. ¬øTiene sill√≠n?", opts: [{ t: "S√≠", next: "check_potencia_45" }, { t: "No", result: "r_prohibido" }] },
            check_potencia_45: { q: "Verificaci√≥n de Potencia / Cilindrada:", opts: [{ t: "‚â§ 50cc o ‚â§ 4000 W", next: "ruedas_4000w" }, { t: "‚â§ 50cc o 4001 W - 6000 W", next: "ruedas_6000w" }, { t: "> 50cc o > 6000 W", next: "ruedas_heavy" }] },
            ruedas_4000w: { q: "Potencia Baja (‚â§4kW). ¬øCu√°ntas ruedas tiene?", opts: [{ t: "2 Ruedas", result: "r_l1e_b" }, { t: "3 Ruedas", result: "r_l2e" }, { t: "4 Ruedas", result: "r_l6e" }] },
            ruedas_6000w: { q: "Potencia Media (4-6kW). ¬øCu√°ntas ruedas tiene?", opts: [{ t: "2 Ruedas", result: "r_l3e" }, { t: "3 Ruedas", next: "check_tipo_3_ruedas" }, { t: "4 Ruedas", result: "r_l6e" }] },
            ruedas_heavy: { q: "Potencia Alta (>6kW). ¬øCu√°ntas ruedas tiene?", opts: [{ t: "2 Ruedas", result: "r_l3e" }, { t: "3 Ruedas", next: "check_tipo_3_ruedas" }, { t: "4 Ruedas", result: "r_l7e" }] },
            vel_mas_45: { q: "Velocidad > 45 km/h. ¬øTiene sill√≠n?", opts: [{ t: "S√≠", next: "ruedas_mas_45" }, { t: "No", result: "r_prohibido" }] },
            ruedas_mas_45: { q: "Alta Velocidad. ¬øCu√°ntas ruedas tiene?", opts: [{ t: "2 Ruedas", result: "r_l3e" }, { t: "3 Ruedas", next: "check_tipo_3_ruedas" }, { t: "4 Ruedas", result: "r_l7e" }] },
            check_tipo_3_ruedas: { q: "Veh√≠culo 3 ruedas. ¬øDisposici√≥n de las ruedas?", opts: [{ t: "Sim√©tricas (Triciclo en eje)", result: "r_l5e" }, { t: "Asim√©tricas (Moto con sidecar)", result: "r_l4e" }] },
            check_altura_sillin: { q: "¬øCu√°l es la altura del sill√≠n (punto R)?", opts: [{ t: "54 cm o m√°s", next: "check_potencia_45" }, { t: "Menos de 54 cm", next: "check_baterias" }] }
        },

        historyStack: [],

        dom: { qArea: document.getElementById('question-area'), modal: document.getElementById('result-modal'), btnBackMain: document.getElementById('btn-back-main') },

        renderStep: function(key) {
            const step = this.steps[key];
            const d = this.dom;
            let html = `<div class="question-header"><h2 class="question-title">${step.q}</h2><button class="help-btn-icon" onclick="document.getElementById('help-modal').style.display='flex'">?</button></div><div class="options-grid">`;
            step.opts.forEach(opt => {
                const action = opt.result ? `app.showResult('${opt.result}')` : `app.nextStep('${key}', '${opt.next}')`;
                html += `<button class="option-btn" onclick="${action}">${opt.t} <span>üëâ</span></button>`;
            });
            html += `</div>`;
            d.qArea.innerHTML = html;
            d.btnBackMain.disabled = (this.historyStack.length === 0);
            d.btnBackMain.style.opacity = (this.historyStack.length === 0) ? "0.5" : "1";
        },

        nextStep: function(currentKey, nextKey) { this.historyStack.push(currentKey); this.renderStep(nextKey); },
        prevStep: function() { if (this.historyStack.length > 0) { const prevKey = this.historyStack.pop(); this.renderStep(prevKey); } },

        showResult: function(resultKey) {
            const data = this.resultsDB[resultKey];
            const m = this.dom.modal;
            const strip = document.getElementById('modal-header-strip');
            const box = document.getElementById('res-legal-box');
            const btnSoa = document.getElementById('btn-soa');

            strip.className = "modal-header-strip";
            box.className = "legal-box";
            if (data.style === "penal" || data.style === "danger") { strip.classList.add("header-danger"); box.classList.add("box-penal"); }
            else if (data.style === "admin") { strip.classList.add("header-success"); box.classList.add("box-admin"); }
            else { strip.classList.add("header-warning"); box.classList.add("box-info"); }

            document.getElementById('res-icon').innerText = data.icon;
            document.getElementById('res-title').innerText = data.title;
            document.getElementById('res-permiso').innerText = data.perm;
            document.getElementById('res-seguro').innerText = data.seg;
            document.getElementById('res-matricula').innerText = data.mat;
            document.getElementById('res-casco').innerText = data.casco;
            box.innerHTML = data.text;

            this.currentSoaData = data.soa;
            if (data.soa) { btnSoa.style.display = 'block'; } else { btnSoa.style.display = 'none'; }
            m.style.display = 'flex';
        },

        showSoaInfraction: function() {
            if(!this.currentSoaData) return;
            if(this.currentSoaData.type === 'vmp_standard') { document.getElementById('inf-note').style.display = 'block'; } 
            else { document.getElementById('inf-note').style.display = 'none'; }
            this.switchInfractionMode('driver');
            document.getElementById('infraction-modal').style.display = 'flex';
        },

        switchInfractionMode: function(mode) {
            this.currentMode = mode;
            const data = this.currentSoaData[mode];
            const btns = document.querySelectorAll('.inf-toggle-btn');
            btns.forEach(btn => btn.classList.remove('active'));
            if(mode === 'driver') btns[0].classList.add('active'); else btns[1].classList.add('active');
            document.getElementById('inf-option').innerText = data.opt;
            document.getElementById('inf-amount').innerText = data.amount + " ‚Ç¨";
            document.getElementById('inf-reduced').innerText = (data.amount / 2) + " ‚Ç¨";
            document.getElementById('inf-text').innerText = data.text;
        },

        closeModal: function() { this.dom.modal.style.display = 'none'; },
        resetApp: function() { this.closeModal(); this.historyStack = []; this.renderStep('start'); }
    };
</script>
</body>
</html>