<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACTA COMPLETA (AJUSTE ESPACIOS)</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* =========================================
           ESTILOS GENERALES
           ========================================= */
        * { box-sizing: border-box; }
        body { background-color: #374151; height: 100vh; overflow: hidden; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; }
        
        .app-layout { display: flex; height: 100vh; overflow: hidden; }
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .toolbar { flex-shrink: 0; }
        
        .sheets-container {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            padding: 40px 0;
            background-color: #6b7280;
        }

        .page-a4 {
            width: 210mm; 
            height: 297mm; 
            min-height: 297mm;
            background: white; 
            padding: 10mm;
            box-shadow: 0 0 25px rgba(0,0,0,0.5); 
            display: flex; 
            flex-direction: column; 
            position: relative; 
            overflow: hidden;
            flex-shrink: 0;
        }

        /* === ESTILOS ANVERSO (FORMULARIO) === */
        .form-container { border: 2px solid black; width: 100%; display: flex; flex-direction: column; background: white; }
        .acta-row { display: flex; width: 100%; border-bottom: 1px solid black; }
        .section-bar { 
            background-color: #e5e7eb; border-bottom: 1px solid black; font-weight: 800; 
            text-align: left; font-size: 11px; padding: 4px 8px; width: 100%; font-style: italic;
            display: flex; align-items: center; justify-content: space-between;
        }
        .form-container > :last-child { border-bottom: none; }
        .field-container { position: relative; display: flex; flex-direction: column; padding: 7px 8px 4px 8px; min-width: 0; border-right: 1px solid black; overflow: hidden; justify-content: center; }
        .field-container.is-last { border-right: none; flex-grow: 1 !important; width: auto !important; }
        .label { font-size: 11px; font-weight: 800; margin-bottom: 4px; white-space: nowrap; overflow: hidden; color: #000; line-height: 1.1; }
        .input-data { width: 100%; font-family: 'Courier New', Courier, monospace; font-weight: 600; outline: none; background: transparent; border: none; padding: 0; color: #000; line-height: 1.2; }
        
        /* Checkboxes ampliados */
        .checkbox-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; padding: 12px; background: white; width: 100%; }
        .checkbox-item { display: flex; align-items: flex-start; font-size: 11px; color: black; padding: 2px 0; cursor: pointer; }
        .custom-checkbox { width: 16px; height: 16px; border: 1.5px solid black; display: flex; align-items: center; justify-content: center; font-family: sans-serif; font-weight: bold; font-size: 14px; line-height: 1; margin-right: 8px; flex-shrink: 0; }
        .custom-checkbox:hover { background-color: #f3f4f6; }
        .checkbox-label { margin-top: 1px; }

        .legal-text { font-size: 10px; text-align: justify; line-height: 1.2; color: #000; margin-top: 10px; }
        .footnotes { font-size: 9px; margin-top: auto; color: #444; line-height: 1.2; padding-top: 3px; border-top: 1px solid #ccc; }
        .header-text { font-size: 11px; line-height: 1.3; text-align: center; color: #000; }
        .header-title { font-weight: bold; font-size: 13px; margin-bottom: 2px; }

        /* === ESTILOS REVERSO: CADENA DE CUSTODIA (GAD) === */
        .cc-container { font-family: 'Arial', sans-serif; color: black; display: flex; flex-direction: column; height: 100%; }
        .cc-header-container { display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px; }
        .cc-header-left { width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; }
        .cc-logo-img { width: 100%; height: 100%; object-fit: contain; }
        .cc-header-right { text-align: right; line-height: 1.2; padding-top: 10px; }
        .cc-line-1 { font-size: 16px; font-weight: 900; color: black; display: block; margin-bottom: 2px; }
        .cc-line-2 { font-size: 12px; font-weight: bold; color: black; display: block; margin-bottom: 2px; }
        .cc-main-title { text-align: center; font-size: 20px; font-weight: 900; text-decoration: underline; text-transform: uppercase; margin-bottom: 15px; margin-top: 10px; }
        
        .cc-box { border: 2px solid #000; margin-bottom: 8px; padding: 35px 10px 10px 10px; position: relative; }
        .cc-box-header { background: #000; color: #fff; font-weight: bold; font-size: 11px; padding: 3px 6px; display: inline-block; position: absolute; top: 5px; left: 5px; }
        
        .cc-field-row { display: flex; align-items: baseline; margin-bottom: 6px; width: 100%; }
        .cc-label { white-space: nowrap; margin-right: 5px; font-weight: 800; font-size: 11px; }
        .cc-input { flex: 1; border: none; border-bottom: 2px dotted #000; background: transparent; font-family: 'Courier New', monospace; font-weight: bold; font-size: 14px; color: #000; outline: none; padding: 0 5px; min-width: 0; margin-left: 5px; }
        .input-short { flex: 0.3 !important; }
        .input-long { flex: 0.7 !important; }

        /* MODIFICADO: Altura aumentada a 155px para rellenar hueco */
        .cc-split-box { display: flex; border: 1px solid #999; margin-top: 5px; height: 155px; }
        
        .cc-sub-box { flex: 1; padding: 8px; display: flex; flex-direction: column; position: relative; }
        .cc-sub-box:first-child { border-right: 1px dotted #000; }
        .cc-sub-title { text-align: center; text-decoration: underline; font-size: 10px; font-weight: bold; margin-bottom: 8px; }
        .cc-firma-placeholder { position: absolute; bottom: 5px; left: 0; width: 100%; text-align: center; color: #999; font-size: 9px; pointer-events: none; }
        
        /* MODIFICADO: Fuente aumentada a 11px */
        .cc-footer-note { background-color: #f3f4f6; padding: 10px; font-size: 11px; line-height: 1.4; text-align: justify; margin-top: auto; border-left: 4px solid #000; }

        /* === ESTILOS REVERSO: DILIGENCIA DE ENTREGA (INTERESADO) === */
        .reverse-container { display: flex; flex-direction: column; height: 100%; position: relative; z-index: 1; padding-top: 20px; }
        .watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 70%; height: auto; opacity: 0.08; z-index: 0; pointer-events: none; filter: grayscale(100%); }
        .reverse-header { text-align: center; border-bottom: 1px solid #ccc; padding-bottom: 20px; margin-bottom: 30px; }
        .reverse-title { font-family: 'Segoe UI', Arial, sans-serif; font-size: 18px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; margin-top: 10px; text-decoration: underline; text-decoration-thickness: 2px; text-underline-offset: 5px; }
        .diligencia-body { font-family: 'Times New Roman', Times, serif; font-size: 16px; line-height: 2.5; text-align: justify; padding: 0 20px; }
        .inline-input { border: none; border-bottom: 2px dotted #000; font-family: 'Courier New', monospace; font-weight: bold; font-size: 16px; outline: none; padding: 0 5px; background: transparent; text-align: center; }
        
        .signatures-box { margin-top: auto; padding-bottom: 50px; display: flex; justify-content: space-around; }
        .signature-block { width: 40%; text-align: center; }
        .signature-line { border-bottom: 1px solid black; margin-top: 50px; margin-bottom: 10px; }
        .signature-label { font-family: 'Segoe UI', Arial, sans-serif; font-size: 12px; font-weight: bold; color: #444; text-transform: uppercase; }

        /* UTILS EDICI√ìN */
        .editing .field-container { background: rgba(59, 130, 246, 0.05); box-shadow: inset 0 0 0 1px #3b82f6; }
        .edit-controls { position: absolute; top: 0; right: 0; display: none; background: white; border: 1px solid #ccc; z-index: 60; }
        .editing .field-container:hover .edit-controls { display: flex; }
        .resizer { position: absolute; right: -5px; top: 0; bottom: 0; width: 10px; cursor: col-resize; z-index: 50; }

        /* IMPRESI√ìN */
        @media print {
            @page { size: A4 portrait; margin: 0; }
            body * { visibility: hidden; }
            .toolbar, .no-print { display: none !important; }
            .sheets-container, .sheets-container * { visibility: visible; }
            .app-layout, .main-content, .sheets-container { display: block !important; height: auto !important; overflow: visible !important; background: white !important; margin: 0 !important; padding: 0 !important; position: static !important; }
            
            .page-a4 { width: 210mm !important; height: 297mm !important; margin: 0 !important; padding: 10mm !important; border: none !important; box-shadow: none !important; position: relative !important; page-break-after: always !important; break-after: page !important; display: block !important; }
            .page-a4:last-child { page-break-after: auto !important; break-after: auto !important; }
            
            .cc-box-header { background: #000 !important; color: #fff !important; -webkit-print-color-adjust: exact; }
            .cc-footer-note { background-color: #eee !important; -webkit-print-color-adjust: exact; }
            .watermark { opacity: 0.1 !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Estructura del formulario
        const initialTemplate = [
            { type: 'row', id: 'r1', fields: [
                {id:'agente1', label:'Agente 1:', width:33.3}, 
                {id:'agente2', label:'Agente 2:', width:33.3},
                {id:'expediente', label:'Expediente Eurocop:', width:33.3}
            ]},
            { type: 'row', id: 'r2', fields: [{id:'lugar', label:'Autoridad que interviene el documento:', width:60}, {id:'fecha', label:'Fecha:', width:20, isDate: true}, {id:'hora', label:'Hora:', width:20}] },
            { type: 'section', title: 'DOCUMENTO / CERTIFICACI√ìN OBJETO DE LA INTERVENCI√ìN:' },
            { type: 'checkbox-group', id: 'cb_docs', items: [
                {key:'doc_pasaporte', label:'Pasaporte'}, {key:'doc_carta', label:'Carta de Identidad'},
                {key:'doc_permiso_con', label:'Permiso de Conducci√≥n'}, {key:'doc_permiso_cir', label:'Permiso de Circulaci√≥n'},
                {key:'doc_itv_tarjeta', label:'Tarjeta Insp. T√©cnica (ITV)'}, {key:'doc_itv_sello', label:'Sello ITV'},
                {key:'doc_placas', label:'Placas de Matr√≠cula'}, {key:'doc_movilidad', label:'Tarjeta Movilidad Reducida'},
                {key:'doc_otro', label:'Otro:'}
            ]},
            { type: 'row', id: 'r_detalles', fields: [{id:'doc_numero', label:'N√∫mero de Documento / Placa / Detalle:', width:100}] },
            { type: 'section', title: 'MOTIVO DE LA INTERVENCI√ìN:' },
            { type: 'checkbox-group', id: 'cb_motivos', items: [
                {key:'mot_judicial', label:'Estudio y remisi√≥n a la Autoridad Judicial.'},
                {key:'mot_destruccion', label:'Destrucci√≥n (No procede devoluci√≥n).'},
                {key:'mot_jefatura', label:'Remisi√≥n a Jefatura Provincial de Tr√°fico.'},
                {key:'mot_otro', label:'Otros.'}
            ]},
            { type: 'section', title: 'DATOS DEL TITULAR / PORTADOR DEL DOCUMENTO:' },
            { type: 'row', id: 'r4', fields: [{id:'p_nom', label:'Nombre y Apellidos', width:65}, {id:'p_doc', label:'DNI / NIE / Pasaporte', width:35}] },
            { type: 'row', id: 'r5', fields: [{id:'p_dom', label:'Domicilio', width:60}, {id:'p_mun', label:'Municipio / Provincia', width:40}] },
            { type: 'row', id: 'r6', fields: [{id:'p_nac_lugar', label:'Nacido/a en (Pa√≠s/Ciudad)', width:40}, {id:'p_nac_fecha', label:'Fecha Nacimiento', width:30, isDate: true}, {id:'p_tel', label:'Tel√©fono / Email', width:30}] },
        ];

        // Componente Input Auto-ajustable
        const AutoResizingInput = ({ value, onChange, disabled, widthDependency, isDate }) => {
            const inputRef = React.useRef(null);
            const [fontSize, setFontSize] = React.useState(15); 
            React.useLayoutEffect(() => {
                const input = inputRef.current;
                if (!input || !value) { setFontSize(15); return; }
                const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
                ctx.font = "600 15px 'Courier New', Courier, monospace";
                const textWidth = ctx.measureText(value).width;
                if (textWidth <= input.clientWidth) setFontSize(15);
                else { const ratio = input.clientWidth / textWidth; setFontSize(Math.max(10, Math.floor(15 * ratio))); }
            }, [value, widthDependency]);
            const handleChange = (e) => {
                let newVal = e.target.value;
                if (isDate) {
                    const digits = newVal.replace(/\D/g, '').slice(0, 8);
                    if (digits.length >= 5) newVal = `${digits.slice(0, 2)}/${digits.slice(2, 4)}/${digits.slice(4)}`;
                    else if (digits.length >= 3) newVal = `${digits.slice(0, 2)}/${digits.slice(2)}`;
                    else newVal = digits;
                }
                onChange({ target: { value: newVal } });
            };
            return <input ref={inputRef} className="input-data" value={value || ''} onChange={handleChange} disabled={disabled} autoComplete="off" style={{ fontSize: `${fontSize}px` }} />;
        };

        // --- COMPONENTE 1: ANVERSO (FORMULARIO) ---
        const ActaForm = ({ template, formData, setFormData, isEditMode, toggleCheckbox, titleSuffix, logos, handleLogoUpload, duplicateField, deleteField, startResize }) => {
            return (
                <div className={`page-a4 ${isEditMode?'editing':''}`}>
                    <div className="flex justify-between items-start mb-4 relative">
                        <div className="w-28 h-28 flex items-start justify-center relative cursor-pointer hover:bg-gray-50 group">
                            {!logos.left ? <span className="text-[9px] text-gray-400">judicial.png</span> : <img src={logos.left} className="w-full h-full object-contain"/>}
                            <input type="file" className="absolute inset-0 opacity-0 cursor-pointer" onChange={(e)=>handleLogoUpload(e,'left')}/>
                        </div>
                        <div className="flex-1 px-2 text-center" contentEditable={isEditMode} suppressContentEditableWarning>
                            <div className="header-title">EXCMO. AYUNTAMIENTO DE ALICANTE</div>
                            <div className="header-title">POLIC√çA LOCAL</div>
                            <div className="header-text mt-3 font-bold">Grupo de An√°lisis Documental</div>
                            <div className="header-text font-bold">Unidad Judicial de Tr√°fico</div>
                            <div className="header-text mt-1">Av. Juli√°n Besteiro 15</div>
                            <div className="header-text text-blue-800 underline">Email: policia.gad@alicante.es</div>
                            <div className="header-text">TEL: +34629111387 - Central PL 965107200</div>
                        </div>
                        <div className="w-28 h-28 flex items-start justify-center relative cursor-pointer hover:bg-gray-50 group">
                            {!logos.right ? <span className="text-[9px] text-gray-400">logogad.png</span> : <img src={logos.right} className="w-full h-full object-contain"/>}
                            <input type="file" className="absolute inset-0 opacity-0 cursor-pointer" onChange={(e)=>handleLogoUpload(e,'right')}/>
                        </div>
                    </div>
                    <div className="text-center font-bold mb-4 text-[13px] tracking-tighter uppercase bg-gray-100 py-2 border border-black w-full leading-tight">
                        ACTA DE INTERVENCI√ìN DE DOCUMENTOS <br/> <span className="text-[11px]">{titleSuffix}</span>
                    </div>
                    <div className="form-container">
                        {template.map((item, rIdx) => {
                            if(item.type === 'section') return <div key={rIdx} className="section-bar" contentEditable={isEditMode} suppressContentEditableWarning>{item.title}</div>;
                            if(item.type === 'checkbox-group') return <div key={item.id} className="acta-row"><div className="checkbox-grid">{item.items.map(cb => (<div key={cb.key} className="checkbox-item" onClick={()=>!isEditMode && toggleCheckbox(cb.key)}><div className="custom-checkbox">{formData[cb.key] ? 'X' : ''}</div><span className="checkbox-label">{cb.label}</span></div>))}</div></div>;
                            if(item.type === 'row') return (<div key={item.id} id={`row-${rIdx}`} className="acta-row">{item.fields.map((f, fIdx) => { const isLast = fIdx === item.fields.length - 1; return (<div key={f.id} className={`field-container ${isLast ? 'is-last' : ''}`} style={{ width: isLast ? 'auto' : `${f.width}%` }}><div className="label" contentEditable={isEditMode} suppressContentEditableWarning>{f.label}</div><AutoResizingInput value={formData[f.id]} onChange={(e)=>setFormData({...formData, [f.id]:e.target.value})} disabled={isEditMode} widthDependency={f.width} isDate={f.isDate}/>{isEditMode && (<><div className="edit-controls"><button onClick={()=>duplicateField(rIdx,fIdx)} className="bg-blue-100 text-blue-700 text-[10px] px-1.5 py-0.5 hover:bg-blue-200 border-r border-blue-200">+</button><button onClick={()=>deleteField(rIdx,fIdx)} className="bg-red-100 text-red-700 text-[10px] px-1.5 py-0.5 hover:bg-red-200">x</button></div>{!isLast && <div className="resizer" onMouseDown={(e)=>startResize(e, rIdx, fIdx, f.width)}></div>}</>)}</div>);})}</div>);
                            return null;
                        })}
                    </div>
                    <div className="legal-text"><p><strong>ADVERTENCIA:</strong> TRANSCURRIDO EL CITADO PLAZO LA PRESENTE ACTA CARECER√Å DE VALIDEZ A TODOS LOS EFECTOS. El titular/poseedor del documento queda advertido que en el plazo de <strong>15 d√≠as</strong> y de no existir motivo que lo justifique, podr√° recoger el mismo en las dependencias de la Polic√≠a Local sita en la <strong>Calle Juli√°n Besteiro 15 (G.A.D)</strong>.</p><p>En su caso y para la devoluci√≥n del documento intervenido, deber√° hacerse entrega de esta Acta de intervenci√≥n. La mera presentaci√≥n del Acta ante las autoridades competentes <strong>no acredita</strong> a su titular que el documento intervenido sea de legal expedici√≥n.</p></div>
                    <div className="mt-0 mb-2 flex justify-between text-xs font-bold pt-2 select-none mt-auto"><div className="w-1/3 mx-3 flex flex-col"><div className="mb-1 text-center text-sm">Fdo.- Implicado/a</div><div className="border-b-2 border-black"></div><div className="h-14"></div></div><div className="w-1/3 mx-3 flex flex-col"><div className="mb-1 text-center text-sm">Fdo. Agente {formData.agente1}</div><div className="border-b-2 border-black"></div><div className="h-14"></div></div><div className="w-1/3 mx-3 flex flex-col"><div className="mb-1 text-center text-sm">Fdo. Agente {formData.agente2}</div><div className="border-b-2 border-black"></div><div className="h-14"></div></div></div>
                    <div className="footnotes"><strong>LEGISLACI√ìN INFORMATIVA:</strong><br/><strong>Art. 282 LECRIM:</strong> ‚ÄúLa Polic√≠a Judicial tiene la obligaci√≥n de averiguar los delitos p√∫blicos y practicar las diligencias necesarias para comprobarlos‚Äù.<br/><strong>Art. 770.3¬∫ LECRIM:</strong> ‚ÄúRecoger y custodiar los efectos, instrumentos o pruebas del delito‚Äù.<br/><strong>Art. 19.2 LO 4/2015:</strong> ‚ÄúAprehensi√≥n durante diligencias de identificaci√≥n u otros efectos procedentes de delito o infracci√≥n administrativa....‚Äù.<br/><strong>Art. 1.4 R.G.Conductores:</strong> ‚ÄúEn el supuesto de que alguna persona est√© en posesi√≥n de m√°s de un permiso de conducci√≥n, le ser√° retirado el que proceda‚Äù.<br/><strong>Art. 56 Ley 39/2015, de 1 de octubre:</strong> del Procedimiento Administrativo Com√∫n de las Administraciones P√∫blicas.</div>
                </div>
            );
        };

        // --- COMPONENTE 2: REVERSO GAD (CADENA DE CUSTODIA) ---
        const CadenaCustodiaPage = ({ formData, setFormData, logos }) => {
            return (
                <div className="page-a4">
                    <div className="cc-container">
                        <div className="cc-header-container">
                            <div className="cc-header-left">{logos.left && <img src={logos.left} className="cc-logo-img"/>}</div>
                            <div className="cc-header-right"><span className="cc-line-1">POLIC√çA LOCAL DE ALICANTE</span><span className="cc-line-2">GRUPO DE AN√ÅLISIS DOCUMENTAL</span><span className="cc-line-2">UNIDAD JUDICIAL</span></div>
                        </div>
                        <div className="cc-main-title">CADENA DE CUSTODIA</div>
                        
                        <div className="cc-box">
                            <div className="cc-box-header">1. DATOS DE REFERENCIA</div>
                            <div className="cc-content">
                                <div className="cc-field-row"><div className="cc-label">N¬∫ DILIGENCIAS / EXPEDIENTE:</div><input className="cc-input" value={formData.expediente || ''} onChange={(e) => setFormData({...formData, expediente: e.target.value})} /></div>
                                <div className="cc-field-row"><div className="cc-label">DESCRIPCI√ìN DEL DOCUMENTO:</div><input className="cc-input" value={formData.doc_numero || ''} onChange={(e) => setFormData({...formData, doc_numero: e.target.value})} /></div>
                                <div className="cc-field-row"><div className="cc-label">Origen inicial:</div><input className="cc-input input-short" value={formData.cc_origen || ''} onChange={(e) => setFormData({...formData, cc_origen: e.target.value})} /><div className="cc-label" style={{marginLeft:'10px'}}>Destino final:</div><input className="cc-input input-long" value={formData.cc_destino || 'G.A.D. (Grupo An√°lisis Documental)'} onChange={(e) => setFormData({...formData, cc_destino: e.target.value})} /></div>
                            </div>
                        </div>

                        <div className="cc-box">
                            <div className="cc-box-header">2. REGISTRO DE TRASPASO (MOVIMIENTO 1)</div>
                            <div className="cc-content">
                                <div className="cc-field-row"><div className="cc-label">Lugar:</div><input className="cc-input" value={formData.m1_lugar || 'Jefatura PL Alicante'} onChange={(e) => setFormData({...formData, m1_lugar: e.target.value})} /><div className="cc-label" style={{marginLeft:'20px'}}>Fecha y Hora:</div><input className="cc-input input-long" value={formData.m1_fechahora || ''} onChange={(e) => setFormData({...formData, m1_fechahora: e.target.value})} /></div>
                                <div className="cc-split-box">
                                    <div className="cc-sub-box"><div className="cc-sub-title">AGENTE QUE ENTREGA</div><div className="cc-field-row" style={{marginBottom:'2px'}}><div className="cc-label" style={{fontSize:'10px'}}>TIP:</div><input className="cc-input" value={formData.m1_entrega_tip || ''} onChange={(e) => setFormData({...formData, m1_entrega_tip: e.target.value})} /></div><div className="cc-field-row"><div className="cc-label" style={{fontSize:'10px'}}>Unidad:</div><input className="cc-input" value={formData.m1_entrega_unidad || ''} onChange={(e) => setFormData({...formData, m1_entrega_unidad: e.target.value})} /></div><div className="cc-firma-placeholder">(Firma)</div></div>
                                    <div className="cc-sub-box"><div className="cc-sub-title">AGENTE RECEPTOR</div><div className="cc-field-row" style={{marginBottom:'2px'}}><div className="cc-label" style={{fontSize:'10px'}}>TIP:</div><input className="cc-input" value={formData.m1_recibe_tip || ''} onChange={(e) => setFormData({...formData, m1_recibe_tip: e.target.value})} /></div><div className="cc-field-row"><div className="cc-label" style={{fontSize:'10px'}}>Unidad:</div><input className="cc-input" value={formData.m1_recibe_unidad || ''} onChange={(e) => setFormData({...formData, m1_recibe_unidad: e.target.value})} /></div><div className="cc-firma-placeholder">(Firma)</div></div>
                                </div>
                                <div className="cc-field-row" style={{marginTop:'10px'}}><div className="cc-label">Observaciones:</div><input className="cc-input" value={formData.m1_observaciones || ''} onChange={(e) => setFormData({...formData, m1_observaciones: e.target.value})} /></div>
                            </div>
                        </div>

                        <div className="cc-box">
                            <div className="cc-box-header">3. REGISTRO DE TRASPASO (MOVIMIENTO 2)</div>
                            <div className="cc-content">
                                <div className="cc-field-row"><div className="cc-label">Lugar:</div><input className="cc-input" value={formData.m2_lugar || ''} onChange={(e) => setFormData({...formData, m2_lugar: e.target.value})} /><div className="cc-label" style={{marginLeft:'20px'}}>Fecha y Hora:</div><input className="cc-input input-long" value={formData.m2_fechahora || ''} onChange={(e) => setFormData({...formData, m2_fechahora: e.target.value})} /></div>
                                <div className="cc-split-box">
                                    <div className="cc-sub-box"><div className="cc-sub-title">AGENTE QUE ENTREGA</div><div className="cc-field-row" style={{marginBottom:'2px'}}><div className="cc-label" style={{fontSize:'10px'}}>TIP:</div><input className="cc-input" value={formData.m2_entrega_tip || ''} onChange={(e) => setFormData({...formData, m2_entrega_tip: e.target.value})} /></div><div className="cc-field-row"><div className="cc-label" style={{fontSize:'10px'}}>Unidad:</div><input className="cc-input" value={formData.m2_entrega_unidad || ''} onChange={(e) => setFormData({...formData, m2_entrega_unidad: e.target.value})} /></div><div className="cc-firma-placeholder">(Firma)</div></div>
                                    <div className="cc-sub-box"><div className="cc-sub-title">AGENTE RECEPTOR</div><div className="cc-field-row" style={{marginBottom:'2px'}}><div className="cc-label" style={{fontSize:'10px'}}>TIP:</div><input className="cc-input" value={formData.m2_recibe_tip || ''} onChange={(e) => setFormData({...formData, m2_recibe_tip: e.target.value})} /></div><div className="cc-field-row"><div className="cc-label" style={{fontSize:'10px'}}>Unidad:</div><input className="cc-input" value={formData.m2_recibe_unidad || ''} onChange={(e) => setFormData({...formData, m2_recibe_unidad: e.target.value})} /></div><div className="cc-firma-placeholder">(Firma)</div></div>
                                </div>
                                <div className="cc-field-row" style={{marginTop:'10px'}}><div className="cc-label">Observaciones:</div><input className="cc-input" value={formData.m2_observaciones || ''} onChange={(e) => setFormData({...formData, m2_observaciones: e.target.value})} /></div>
                            </div>
                        </div>

                        <div className="cc-footer-note"><strong>NOTA DE CUSTODIA FINAL:</strong><br/><br/>Los documentos originales o efectos rese√±ados en la presente acta quedan depositados bajo la estricta custodia y responsabilidad del <strong>Grupo de An√°lisis Documental</strong>, adscrito a la Unidad Judicial de Tr√°fico de la Polic√≠a Local de Alicante.<br/>Dichos efectos permanecen en calidad de dep√≥sito a la entera y exclusiva disposici√≥n de la Autoridad Judicial competente, para el caso de que se estimase pertinente su remisi√≥n.</div>
                    </div>
                </div>
            );
        };

        // --- COMPONENTE 3: REVERSO INTERESADO (DILIGENCIA DE ENTREGA) ---
        const DiligenciaEntregaPage = ({ formData, setFormData, logos }) => {
            return (
                <div className="page-a4">
                    <div className="reverse-container">
                        {logos.left && <img src={logos.left} className="watermark" alt="Watermark" />}
                        <div className="reverse-header">
                            <div className="header-text font-bold text-gray-500">EXCMO. AYUNTAMIENTO DE ALICANTE - POLIC√çA LOCAL</div>
                            <div className="reverse-title">DILIGENCIA DE ENTREGA DE DOCUMENTACI√ìN</div>
                        </div>
                        <div className="diligencia-body">
                            <p>Se extiende la presente para hacer constar que siendo las <input className="inline-input" style={{width:'80px'}} value={formData.entrega_hora || ''} onChange={(e)=>setFormData({...formData, entrega_hora:e.target.value})} /> horas del d√≠a <input className="inline-input" style={{width:'150px'}} value={formData.entrega_dia || ''} onChange={(e)=>setFormData({...formData, entrega_dia:e.target.value})} />, y tras haber finalizado las comprobaciones pertinentes por las cuales se procedi√≥ a la intervenci√≥n cautelar del citado documento rese√±ado en el anverso, se procede a hacer <strong>ENTREGA</strong> del mismo a D./D√±a:</p>
                            <p style={{marginTop: '20px', textAlign: 'center'}}><input className="inline-input" style={{width:'90%'}} value={formData.p_nom || ''} onChange={(e)=>setFormData({...formData, p_nom:e.target.value})} /></p>
                            <p>con n√∫mero de Documento Oficial de Identidad (DOI): <input className="inline-input" style={{width:'250px'}} value={formData.p_doc || ''} onChange={(e)=>setFormData({...formData, p_doc:e.target.value})} />.</p>
                            <p style={{marginTop: '20px'}}>Quien firma la presente en prueba de total conformidad y recibo, de lo cual, como Agente actuante, extiendo esta diligencia y certifico.</p>
                        </div>
                        <div className="signatures-box">
                            <div className="signature-block"><div className="signature-line"></div><div className="signature-label">RECIB√ç (EL IMPLICADO/A)</div></div>
                            <div className="signature-block"><div className="signature-line"></div><div className="signature-label">EL AGENTE (Firma y TIP)</div></div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [template, setTemplate] = React.useState(initialTemplate);
            const [formData, setFormData] = React.useState({});
            const [isEditMode, setIsEditMode] = React.useState(false);
            const [logos, setLogos] = React.useState({ left: 'judicial.png', right: 'logogad.png' });
            const [dragState, setDragState] = React.useState(null);

            React.useEffect(() => {
                const l = JSON.parse(localStorage.getItem('mis_logos_intervencion_v15'));
                if(l) setLogos(l);
            }, []);

            const toggleCheckbox = (key) => setFormData(prev => ({...prev, [key]: !prev[key]}));
            const handleLogoUpload = (e, key) => { const f = e.target.files[0]; if(f){ const r = new FileReader(); r.onload = (ev) => { const newLogos = {...logos, [key]: ev.target.result}; setLogos(newLogos); localStorage.setItem('mis_logos_intervencion_v15', JSON.stringify(newLogos)); }; r.readAsDataURL(f); } };
            
            // L√≥gica Resize
            React.useEffect(() => {
                const handleMouseMove = (e) => {
                    if (!dragState) return;
                    e.preventDefault(); const row = document.getElementById(`row-${dragState.rIdx}`);
                    if (!row) return; const deltaPercent = ((e.clientX - dragState.startX) / row.offsetWidth) * 100;
                    setTemplate(prev => { const n = [...prev]; n[dragState.rIdx].fields[dragState.fIdx].width = Math.max(5, dragState.startW + deltaPercent); return n; });
                };
                const handleMouseUp = () => setDragState(null);
                if (dragState) { document.addEventListener('mousemove', handleMouseMove); document.addEventListener('mouseup', handleMouseUp); }
                return () => { document.removeEventListener('mousemove', handleMouseMove); document.removeEventListener('mouseup', handleMouseUp); };
            }, [dragState]);

            const startResize = (e, rIdx, fIdx, w) => { e.preventDefault(); e.stopPropagation(); setDragState({rIdx, fIdx, startX: e.clientX, startW: w}); };
            const duplicateField = (r, f) => { const t=[...template]; const o=t[r].fields[f]; t[r].fields.splice(f+1,0,{...o, id:Date.now(), label:o.label+' (C)', width:15, isDate: o.isDate}); o.width-=15; setTemplate(t); };
            const deleteField = (r, f) => { const t=[...template]; const w=t[r].fields[f].width; t[r].fields.splice(f,1); if(t[r].fields[0]) t[r].fields[0].width+=w; setTemplate(t); };

            const sharedProps = { template, formData, setFormData, isEditMode, toggleCheckbox, logos, handleLogoUpload, duplicateField, deleteField, startResize };

            return (
                <div className="app-layout">
                    <div className="main-content bg-gray-200">
                        <div className="toolbar bg-white p-2 shadow flex justify-between items-center z-50 h-14">
                            <div className="font-bold text-gray-700 text-sm flex items-center gap-2">
                                <span>ACTA COMPLETA MANUAL (4 P√ÅGINAS)</span>
                            </div>
                            <div className="flex gap-2 items-center">
                                <button onClick={()=>setIsEditMode(!isEditMode)} className={`px-3 py-1.5 rounded text-sm font-medium transition-colors ${isEditMode ? 'bg-yellow-500 text-black shadow-inner' : 'bg-gray-100 text-gray-600 hover:bg-gray-200 border border-gray-300'}`}>{isEditMode ? 'üîí Terminar' : 'üõ†Ô∏è Editar'}</button>
                                <button onClick={()=>window.print()} className="bg-gray-800 text-white px-4 py-1.5 rounded text-sm hover:bg-gray-900 shadow-sm font-medium">üñ®Ô∏è Imprimir</button>
                            </div>
                        </div>

                        <div className="sheets-container">
                            {/* HOJA 1: ANVERSO GAD */}
                            <ActaForm {...sharedProps} titleSuffix="(EJEMPLAR PARA EL GAD)" />
                            
                            {/* HOJA 2: REVERSO GAD (CADENA DE CUSTODIA) */}
                            <CadenaCustodiaPage formData={formData} setFormData={setFormData} logos={logos} />
                            
                            {/* HOJA 3: ANVERSO INTERESADO (COPIA) */}
                            <ActaForm {...sharedProps} titleSuffix="(EJEMPLAR PARA EL INTERESADO)" />

                            {/* HOJA 4: REVERSO INTERESADO (DILIGENCIA ENTREGA) */}
                            <DiligenciaEntregaPage formData={formData} setFormData={setFormData} logos={logos} />
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>