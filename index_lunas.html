<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Decodificador Lunas Profesional</title>
    <style>
        :root {
            --bg-color: #1a1a1a; 
            --panel-bg: #252525;
            --text-color: #f0f0f0;
            --accent-red: #d32f2f;
            --dot-off: #444444;
            --dot-on: #ffd700;
            --nippon-red: #ef4444;
            --nippon-blue: #3b82f6;
            --glow: 0 0 12px rgba(255, 215, 0, 0.7);
            --label-text: #999;
            
            --letter-size: 2.5rem;
            --dot-size: 14px;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 5px;
            margin: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- NAVEGACIÓN --- */
        .tabs-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            width: 100%;
            max-width: 600px;
            margin-bottom: 15px;
        }

        .tab-btn {
            background: #333;
            border: 1px solid #444;
            color: #aaa;
            padding: 0;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 0.6rem;
            font-weight: bold;
            letter-spacing: 0.5px;
            border-radius: 4px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 45px;
            text-align: center;
            line-height: 1.1;
            padding: 2px;
        }

        .tab-btn.active {
            background: var(--accent-red);
            color: white;
            border-color: var(--accent-red);
        }

        /* --- CONTENEDOR PRINCIPAL --- */
        .glass-container {
            background: var(--panel-bg);
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            padding: 25px 0 80px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            width: 100%;
            max-width: 800px;
            box-sizing: border-box;
            position: relative;
            min-height: 400px;
            z-index: 1; 
        }

        /* --- LEYENDA / INSTRUCCIONES --- */
        .input-legend {
            color: #777;
            font-size: 0.8rem;
            text-align: center;
            margin-top: 10px;
            font-style: italic;
            padding: 0 20px;
        }

        /* --- LOGOS INFERIORES --- */
        .corner-logo {
            position: absolute;
            bottom: 15px;
            height: 80px;
            width: auto;
            opacity: 0.8;
            z-index: 0;
            pointer-events: none;
        }
        .logo-left { left: 15px; }
        .logo-right { right: 15px; }

        .brand-section {
            display: none;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        .brand-section.active { display: flex; }

        /* --- ESTRUCTURA GENERAL --- */
        .word-row {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            position: relative;
        }

        .letters-group {
            display: flex;
            justify-content: center;
            gap: 1vw; 
        }

        .letter-col {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 9vw;
            max-width: 45px;
            position: relative;
            cursor: pointer;
        }

        .letter {
            font-family: 'Arial Black', sans-serif;
            font-size: var(--letter-size);
            color: var(--accent-red);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.6);
            line-height: 1;
            margin: 6px 0;
            cursor: default;
            user-select: none;
        }

        .side-col {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 12vw;
            max-width: 50px;
            position: relative;
            height: 100%;
            padding-top: 10px; 
        }

        .dot-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 30px;
            position: relative;
            z-index: 10;
        }
        
        .dot-wrapper.absolute {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }
        .pos-top-floating { top: -35px; } 
        .pos-bot-floating { bottom: -35px; }
        
        .lbl {
            font-size: 0.55rem;
            color: var(--label-text);
            text-transform: uppercase;
            font-weight: bold;
            margin-bottom: 1px;
            white-space: nowrap;
        }
        .lbl-bot { margin-bottom: 0; margin-top: 1px; }

        /* ESTILOS TRIPLEX ESPECÍFICOS */
        .dot-stack {
            display: flex;
            flex-direction: column-reverse;
            gap: 4px;
            height: 40px;
            justify-content: flex-start;
            align-items: center;
            margin-bottom: 2px;
        }
        .triplex-num {
            font-size: 0.8rem;
            color: #aaa;
            font-weight: bold;
            margin-top: -2px;
        }
        .triplex-mid-word {
            text-align: center;
            color: #777;
            font-size: 1.8rem; /* MÁS GRANDE */
            font-weight: bold;
            letter-spacing: 2px;
            margin: 15px 0;
            text-transform: capitalize; /* Sundym */
        }
        /* Clase para letras en minúscula (toughened) */
        .letter-lower {
            text-transform: lowercase !important;
        }

        input[type="radio"], input[type="checkbox"] { display: none; }

        label {
            display: flex; justify-content: center; align-items: center;
            padding: 8px; margin: -8px; cursor: pointer;
            z-index: 10;
        }

        .dot {
            width: var(--dot-size); height: var(--dot-size);
            background-color: var(--dot-off);
            border: 2px solid #666; border-radius: 50%;
            transition: all 0.2s;
        }
        
        input[type="radio"]:checked + .dot, .dot.active {
            background-color: var(--dot-on); border-color: #fff;
            box-shadow: var(--glow); transform: scale(1.3);
        }
        
        .dot-stack .dot { opacity: 0.2; }
        .dot-stack .dot.active { opacity: 1; }

        /* --- ESTILOS GENÉRICO --- */
        .gen-container {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        .gen-dots-group { display: flex; gap: 4px; }

        .gen-dot {
            width: 20px; height: 20px;
            background-color: var(--dot-off);
            border: 2px solid #555;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .gen-dot.active {
            background-color: var(--dot-on);
            border-color: white;
            box-shadow: 0 0 10px var(--dot-on);
            transform: scale(1.2);
        }

        .gen-num-display {
            font-family: 'Arial', sans-serif;
            font-weight: 900;
            font-size: 5rem;
            color: var(--text-color);
            border: 2px dashed #555;
            border-radius: 12px;
            width: 90px;
            height: 110px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 15px;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s;
            line-height: 1;
        }
        .gen-num-display:active {
            border-color: var(--accent-red);
            color: var(--accent-red);
            transform: scale(0.95);
        }

        /* --- ESTILOS NIPPON SAFETY --- */
        .nippon-wrapper {
            position: relative;
            width: 100%;
            height: 320px; 
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .nippon-letter {
            position: absolute;
            font-family: 'Arial Black', sans-serif;
            font-weight: 900;
            color: #cc0000;
            font-size: 2.2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.6);
            transform-origin: center center;
            display: flex; justify-content: center; align-items: center;
            pointer-events: none;
            line-height: 1;
        }

        .n-elem {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transform: translate(-50%, -50%);
            z-index: 20;
        }

        .n-dot {
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.15s;
            width: 18px;
            height: 18px;
            border: 2px solid #333;
        }
        
        .n-lbl {
            font-size: 0.55rem;
            color: #aaa;
            font-weight: bold;
            position: absolute;
            white-space: nowrap;
            text-shadow: 1px 1px 2px black;
        }
        .n-lbl-top { top: -18px; }
        .n-lbl-bot { bottom: -18px; }

        .n-dot-red { background-color: #7f1d1d; box-shadow: 0 0 5px rgba(0,0,0,0.5); }
        .n-dot-red.selected { background-color: var(--nippon-red); border-color: white; transform: scale(1.4); box-shadow: 0 0 15px var(--nippon-red); }
        .n-dot-blue { background-color: #1e3a8a; display: flex; justify-content: center; align-items: center; color: #aaa; font-size: 10px; font-weight: bold; width: 24px; height: 24px; }
        .n-dot-blue.selected { background-color: var(--nippon-blue); border-color: white; color: white; transform: scale(1.3); box-shadow: 0 0 15px var(--nippon-blue); }

        .btn-calc-nippon {
            background: #22c55e; color: #022c22;
            font-weight: bold; text-transform: uppercase; letter-spacing: 1px;
            padding: 12px 30px; border-radius: 6px;
            font-size: 1rem; border: none; cursor: pointer;
            margin-top: 10px;
            box-shadow: 0 4px 10px rgba(34, 197, 94, 0.3);
            z-index: 10;
        }
        .btn-calc-nippon:active { transform: scale(0.98); }

        /* --- VENTANA MODAL DE AYUDA --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 9999; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .help-box { background: #222; border: 2px solid #ffd700; border-radius: 12px; padding: 25px; width: 90%; max-width: 500px; max-height: 85vh; overflow-y: auto; box-shadow: 0 0 50px rgba(0,0,0,1); position: relative; text-align: left; }
        .close-help-btn { display: block; width: 100%; background: #d32f2f; color: white; text-align: center; padding: 12px; border: none; border-radius: 6px; font-weight: bold; font-size: 1rem; cursor: pointer; margin-top: 20px; text-transform: uppercase; }
        .close-help-btn:hover { background: #b71c1c; }
        .help-content h3 { color: #ffd700; border-bottom: 1px solid #444; padding-bottom: 10px; margin-top: 0; text-transform: uppercase; text-align: center;}
        .help-content h4 { color: var(--accent-red); margin-bottom: 5px; margin-top: 20px; font-size: 1.1rem; }
        .help-content p { margin-bottom: 10px; color: #ccc; font-size: 0.95rem; line-height: 1.5; }
        .help-note { background: rgba(255, 215, 0, 0.1); padding: 15px; border-left: 4px solid #ffd700; border-radius: 4px; font-size: 0.9rem; color: #eee; margin-top: 15px;}

        /* --- RESULTADO Y BOTÓN AYUDA --- */
        .result-box {
            margin-top: 20px; background: rgba(30, 30, 30, 0.95);
            border-left: 5px solid var(--dot-on); padding: 15px 15px 15px 25px;
            width: auto; min-width: 280px; max-width: 90%; 
            border-radius: 0 8px 8px 0; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            position: relative; z-index: 10;
            display: flex; align-items: center; justify-content: space-between; gap: 15px;
        }
        .res-content { text-align: left; flex-grow: 1; }
        .res-main { font-size: 1.3rem; color: white; font-weight: bold; margin-bottom: 4px; line-height: 1.2; display: block;}
        .res-sub { color: #aaa; font-size: 0.8rem; }
        .hl { color: var(--dot-on); }
        .help-btn-small { background: #444; color: #ffd700; border: 1px solid #666; border-radius: 4px; padding: 5px 12px; font-size: 0.75rem; font-weight: bold; cursor: pointer; text-transform: uppercase; transition: all 0.2s; white-space: nowrap; }
        .help-btn-small:hover { background: #555; color: #fff; }

        /* --- MEDIA QUERIES --- */
        @media (max-width: 600px) {
            :root { --letter-size: 1.8rem; --dot-size: 12px; }
            .pos-top-floating { top: -28px; } .pos-bot-floating { bottom: -28px; }
            .glass-container { padding: 20px 0 70px 0; }
            .nippon-wrapper { transform: scale(0.85); margin: -20px 0; }
            .corner-logo { height: 50px; bottom: 10px; }
            .logo-left { left: 10px; } .logo-right { right: 10px; }
            
            .gen-num-display { font-size: 4rem; width: 70px; height: 90px; margin: 0 10px; }
            .gen-dot { width: 14px; height: 14px; }
            .gen-dots-group { gap: 3px; }
            
            #hyundai .letters-group { gap: 1px; }
            #hyundai .letter-col { width: 7vw; }
            #hyundai .letter { font-size: 1.4rem; }
            
            #triplex-months .letters-group { gap: 2px; }
            #triplex-months .letter { font-size: 1.6rem; }
        }
        @media (max-width: 360px) {
            :root { --letter-size: 1.4rem; --dot-size: 10px; }
            .nippon-wrapper { transform: scale(0.7); margin: -40px 0; }
            .gen-num-display { font-size: 3rem; width: 60px; height: 80px; }
        }
    </style>
</head>
<body>

    <div class="tabs-container">
        <div class="tab-btn active" onclick="openTab('generic')">Genérico</div>
        <div class="tab-btn" onclick="openTab('hyundai')">43R<br>(Hyundai-Kia)</div>
        <div class="tab-btn" onclick="openTab('laminex')">Laminex</div>
        <div class="tab-btn" onclick="openTab('lamisafe')">Lamisafe</div>
        <div class="tab-btn" onclick="openTab('nippon')">Nippon Safety<br>(Toyota)</div>
        <div class="tab-btn" onclick="openTab('tempalex')">Tempalex</div>
        <div class="tab-btn" onclick="openTab('temperlite')">Temperlite</div>
        <div class="tab-btn" onclick="openTab('triplex')">Triplex</div>
    </div>

    <div class="glass-container">
        
        <img src="logogad2.png" alt="Logo Izq" class="corner-logo logo-left">
        <img src="logogad.png" alt="Logo Der" class="corner-logo logo-right">

        <div id="generic" class="brand-section active">
            <div class="gen-container">
                <div class="gen-dots-group" id="gen-left-dots"></div>
                <div class="gen-num-display" id="genNumDisplay" onclick="toggleGenYear()">4</div>
                <div class="gen-dots-group" id="gen-right-dots"></div>
            </div>
            <p class="input-legend">Toca el número para cambiar el AÑO - Toca los puntos para cambiar el MES</p>
        </div>

        <div id="hyundai" class="brand-section">
            <div class="word-row">
                <div class="side-col">
                    <div class="dot-wrapper"><span class="lbl">Ene</span><label><input type="radio" name="mes" value="Enero" onchange="calc()"><div class="dot"></div></label></div>
                </div>
                <div class="letters-group">
                    <div class="letter-col"><div class="dot-wrapper"><span class="lbl">1</span><label><input type="radio" name="anio" value="1" onchange="calc()"><div class="dot"></div></label></div><div class="letter">4</div><div class="dot-wrapper"><label><input type="radio" name="mes" value="Febrero" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">Feb</span></div></div>
                    <div class="letter-col"><div class="dot-wrapper"><span class="lbl">2</span><label><input type="radio" name="anio" value="2" onchange="calc()"><div class="dot"></div></label></div><div class="letter">3</div><div class="dot-wrapper"><label><input type="radio" name="mes" value="Marzo" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">Mar</span></div></div>
                    <div class="letter-col"><div class="dot-wrapper"><span class="lbl">3</span><label><input type="radio" name="anio" value="3" onchange="calc()"><div class="dot"></div></label></div><div class="letter">R</div><div class="dot-wrapper"><label><input type="radio" name="mes" value="Abril" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">Abr</span></div></div>
                    <div class="letter-col"><div class="dot-wrapper"><span class="lbl">4</span><label><input type="radio" name="anio" value="4" onchange="calc()"><div class="dot"></div></label></div><div class="letter">-</div><div class="dot-wrapper"><label><input type="radio" name="mes" value="Mayo" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">May</span></div></div>
                    <div class="letter-col"><div class="dot-wrapper"><span class="lbl">5</span><label><input type="radio" name="anio" value="5" onchange="calc()"><div class="dot"></div></label></div><div class="letter">0</div><div class="dot-wrapper"><label><input type="radio" name="mes" value="Junio" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">Jun</span></div></div>
                    <div class="letter-col"><div class="dot-wrapper"><span class="lbl">6</span><label><input type="radio" name="anio" value="6" onchange="calc()"><div class="dot"></div></label></div><div class="letter">1</div><div class="dot-wrapper"><label><input type="radio" name="mes" value="Julio" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">Jul</span></div></div>
                    <div class="letter-col"><div class="dot-wrapper"><span class="lbl">7</span><label><input type="radio" name="anio" value="7" onchange="calc()"><div class="dot"></div></label></div><div class="letter">6</div><div class="dot-wrapper"><label><input type="radio" name="mes" value="Agosto" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">Ago</span></div></div>
                    <div class="letter-col"><div class="dot-wrapper"><span class="lbl">8</span><label><input type="radio" name="anio" value="8" onchange="calc()"><div class="dot"></div></label></div><div class="letter">9</div><div class="dot-wrapper"><label><input type="radio" name="mes" value="Septiembre" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">Sep</span></div></div>
                    <div class="letter-col"><div class="dot-wrapper"><span class="lbl">9</span><label><input type="radio" name="anio" value="9" onchange="calc()"><div class="dot"></div></label></div><div class="letter">4</div><div class="dot-wrapper"><label><input type="radio" name="mes" value="Octubre" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">Oct</span></div></div>
                    <div class="letter-col"><div class="dot-wrapper"><span class="lbl">0</span><label><input type="radio" name="anio" value="0" onchange="calc()"><div class="dot"></div></label></div><div class="letter">4</div><div class="dot-wrapper"><label><input type="radio" name="mes" value="Noviembre" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">Nov</span></div></div>
                </div>
                <div class="side-col">
                    <div class="dot-wrapper"><span class="lbl">Dic</span><label><input type="radio" name="mes" value="Diciembre" onchange="calc()"><div class="dot"></div></label></div>
                </div>
            </div>
            <p class="input-legend">Marca el punto superior para AÑO y el inferior para MES</p>
        </div>

        <div id="triplex" class="brand-section">
            <div class="word-row">
                <div class="letters-group" id="triplex-months">
                    <div class="letter-col" onclick="toggleTriplex(0, 2)"><div class="dot-stack"><div class="dot" id="tm-0-2"></div><div class="dot" id="tm-0-1"></div></div><div class="letter">T</div></div>
                    <div class="letter-col" onclick="toggleTriplex(1, 1)"><div class="dot-stack"><div class="dot" id="tm-1-1"></div></div><div class="letter">R</div></div>
                    <div class="letter-col" onclick="toggleTriplex(2, 1)"><div class="dot-stack"><div class="dot" id="tm-2-1"></div></div><div class="letter">I</div></div>
                    <div class="letter-col" onclick="toggleTriplex(3, 1)"><div class="dot-stack"><div class="dot" id="tm-3-1"></div></div><div class="letter">P</div></div>
                    <div class="letter-col" onclick="toggleTriplex(4, 1)"><div class="dot-stack"><div class="dot" id="tm-4-1"></div></div><div class="letter">L</div></div>
                    <div class="letter-col" onclick="toggleTriplex(5, 1)"><div class="dot-stack"><div class="dot" id="tm-5-1"></div></div><div class="letter">E</div></div>
                    <div class="letter-col" onclick="toggleTriplex(6, 2)"><div class="dot-stack"><div class="dot" id="tm-6-2"></div><div class="dot" id="tm-6-1"></div></div><div class="letter">X</div></div>
                </div>
            </div>
            <p class="triplex-mid-word">Sundym</p>
            <div class="word-row">
                <div class="letters-group">
                    <div class="letter-col" onclick="setTriplexYear(1)"><div class="letter letter-lower">T</div><div class="dot-wrapper"><div class="dot" id="ty-1"></div><span class="triplex-num">1</span></div></div>
                    <div class="letter-col" onclick="setTriplexYear(2)"><div class="letter letter-lower">O</div><div class="dot-wrapper"><div class="dot" id="ty-2"></div><span class="triplex-num">2</span></div></div>
                    <div class="letter-col" onclick="setTriplexYear(3)"><div class="letter letter-lower">U</div><div class="dot-wrapper"><div class="dot" id="ty-3"></div><span class="triplex-num">3</span></div></div>
                    <div class="letter-col" onclick="setTriplexYear(4)"><div class="letter letter-lower">G</div><div class="dot-wrapper"><div class="dot" id="ty-4"></div><span class="triplex-num">4</span></div></div>
                    <div class="letter-col" onclick="setTriplexYear(5)"><div class="letter letter-lower">H</div><div class="dot-wrapper"><div class="dot" id="ty-5"></div><span class="triplex-num">5</span></div></div>
                    <div class="letter-col" onclick="setTriplexYear(6)"><div class="letter letter-lower">E</div><div class="dot-wrapper"><div class="dot" id="ty-6"></div><span class="triplex-num">6</span></div></div>
                    <div class="letter-col" onclick="setTriplexYear(7)"><div class="letter letter-lower">N</div><div class="dot-wrapper"><div class="dot" id="ty-7"></div><span class="triplex-num">7</span></div></div>
                    <div class="letter-col" onclick="setTriplexYear(8)"><div class="letter letter-lower">E</div><div class="dot-wrapper"><div class="dot" id="ty-8"></div><span class="triplex-num">8</span></div></div>
                    <div class="letter-col" onclick="setTriplexYear(9)"><div class="letter letter-lower">D</div><div class="dot-wrapper"><div class="dot" id="ty-9"></div><span class="triplex-num">9</span></div></div>
                    <div class="letter-col" onclick="setTriplexYear(0)"><div class="letter letter-lower" style="opacity:0">.</div><div class="dot-wrapper"><div class="dot" id="ty-0"></div><span class="triplex-num">0</span></div></div>
                </div>
            </div>
            <button onclick="calcTriplexResult()" class="btn-calc-nippon">CALCULAR</button>
            <p class="input-legend">Marca los puntos y pulsa Calcular. (Permite selección múltiple)</p>
        </div>

        <div id="laminex" class="brand-section">
            <div class="word-row">
                <div class="side-col"><div class="dot-wrapper"><span class="lbl">Feb</span><label><input type="radio" name="mes" value="Febrero" onchange="calc()"><div class="dot"></div></label></div></div>
                <div class="letters-group">
                    <div class="letter-col"><div class="dot-wrapper"><span class="lbl">Mar</span><label><input type="radio" name="mes" value="Marzo" onchange="calc()"><div class="dot"></div></label></div><div class="letter">L</div><div class="dot-wrapper absolute pos-bot-floating"><label><input type="radio" name="mes" value="Enero" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">Ene</span></div></div>
                    <div class="letter-col"><div class="dot-wrapper"><span class="lbl">Abr</span><label><input type="radio" name="mes" value="Abril" onchange="calc()"><div class="dot"></div></label></div><div class="letter">A</div></div>
                    <div class="letter-col"><div class="dot-wrapper"><span class="lbl">May</span><label><input type="radio" name="mes" value="Mayo" onchange="calc()"><div class="dot"></div></label></div><div class="letter">M</div></div>
                    <div class="letter-col"><div class="dot-wrapper"><span class="lbl">Jun</span><label><input type="radio" name="mes" value="Junio" onchange="calc()"><div class="dot"></div></label></div><div class="letter">I</div></div>
                    <div class="letter-col"><div class="dot-wrapper"><span class="lbl">Jul</span><label><input type="radio" name="mes" value="Julio" onchange="calc()"><div class="dot"></div></label></div><div class="letter">N</div></div>
                    <div class="letter-col"><div class="dot-wrapper"><span class="lbl">Ago</span><label><input type="radio" name="mes" value="Agosto" onchange="calc()"><div class="dot"></div></label></div><div class="letter">E</div></div>
                    <div class="letter-col"><div class="dot-wrapper"><span class="lbl">Sep</span><label><input type="radio" name="mes" value="Septiembre" onchange="calc()"><div class="dot"></div></label></div><div class="letter">X</div><div class="dot-wrapper absolute pos-bot-floating"><label><input type="radio" name="mes" value="Diciembre" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">Dic</span></div></div>
                </div>
                <div class="side-col"><div class="dot-wrapper absolute pos-top-floating"><span class="lbl">Oct</span><label><input type="radio" name="mes" value="Octubre" onchange="calc()"><div class="dot"></div></label></div><div class="dot-wrapper"><span class="lbl">Nov</span><label><input type="radio" name="mes" value="Noviembre" onchange="calc()"><div class="dot"></div></label></div></div>
            </div>
            <div class="word-row" style="margin-top: 30px;">
                <div class="side-col"><div class="dot-wrapper"><label><input type="radio" name="anio" value="0" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">0</span></div></div>
                <div class="letters-group">
                    <div class="letter-col"><div class="letter">C</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="9" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">9</span></div></div>
                    <div class="letter-col"><div class="letter">E</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="8" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">8</span></div></div>
                    <div class="letter-col"><div class="letter">N</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="7" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">7</span></div></div>
                    <div class="letter-col"><div class="letter">T</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="6" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">6</span></div></div>
                    <div class="letter-col"><div class="letter">R</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="5" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">5</span></div></div>
                    <div class="letter-col"><div class="letter">A</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="4" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">4</span></div></div>
                    <div class="letter-col"><div class="letter">L</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="3" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">3</span></div></div>
                </div>
                <div class="side-col"><div class="dot-wrapper absolute pos-top-floating"><label><input type="radio" name="anio" value="1" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">1</span></div><div class="dot-wrapper"><label><input type="radio" name="anio" value="2" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">2</span></div></div>
            </div>
            <p class="input-legend">Marca el punto del MES y el punto del AÑO</p>
        </div>

        <div id="tempalex" class="brand-section">
            <div class="word-row"><div class="side-col"><div class="dot-wrapper"><span class="lbl">Feb</span><label><input type="radio" name="mes" value="Febrero" onchange="calc()"><div class="dot"></div></label></div></div><div class="letters-group"><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Mar</span><label><input type="radio" name="mes" value="Marzo" onchange="calc()"><div class="dot"></div></label></div><div class="letter">T</div><div class="dot-wrapper absolute pos-bot-floating"><label><input type="radio" name="mes" value="Enero" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">Ene</span></div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Abr</span><label><input type="radio" name="mes" value="Abril" onchange="calc()"><div class="dot"></div></label></div><div class="letter">E</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">May</span><label><input type="radio" name="mes" value="Mayo" onchange="calc()"><div class="dot"></div></label></div><div class="letter">M</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Jun</span><label><input type="radio" name="mes" value="Junio" onchange="calc()"><div class="dot"></div></label></div><div class="letter">P</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Jul</span><label><input type="radio" name="mes" value="Julio" onchange="calc()"><div class="dot"></div></label></div><div class="letter">A</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Ago</span><label><input type="radio" name="mes" value="Agosto" onchange="calc()"><div class="dot"></div></label></div><div class="letter">L</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Sep</span><label><input type="radio" name="mes" value="Septiembre" onchange="calc()"><div class="dot"></div></label></div><div class="letter">E</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Oct</span><label><input type="radio" name="mes" value="Octubre" onchange="calc()"><div class="dot"></div></label></div><div class="letter">X</div><div class="dot-wrapper absolute pos-bot-floating"><label><input type="radio" name="mes" value="Diciembre" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">Dic</span></div></div></div><div class="side-col"><div class="dot-wrapper"><span class="lbl">Nov</span><label><input type="radio" name="mes" value="Noviembre" onchange="calc()"><div class="dot"></div></label></div></div></div>
            <p style="color:#777; font-size:0.6rem; letter-spacing:1px; margin:0;">AÑO (CENTRAL)</p>
            <div class="word-row" style="margin-top: 30px;"><div class="side-col"><div class="dot-wrapper"><label><input type="radio" name="anio" value="0" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">0</span></div></div><div class="letters-group"><div class="letter-col"><div class="letter">C</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="9" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">9</span></div></div><div class="letter-col"><div class="letter">E</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="8" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">8</span></div></div><div class="letter-col"><div class="letter">N</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="7" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">7</span></div></div><div class="letter-col"><div class="letter">T</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="6" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">6</span></div></div><div class="letter-col"><div class="letter">R</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="5" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">5</span></div></div><div class="letter-col"><div class="letter">A</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="4" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">4</span></div></div><div class="letter-col"><div class="letter">L</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="3" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">3</span></div></div></div><div class="side-col"><div class="dot-wrapper absolute pos-top-floating"><label><input type="radio" name="anio" value="1" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">1</span></div><div class="dot-wrapper"><label><input type="radio" name="anio" value="2" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">2</span></div></div></div>
            <p class="input-legend">Marca el punto del MES y el punto del AÑO</p>
        </div>

        <div id="temperlite" class="brand-section">
            <div class="word-row"><div class="side-col"><div class="dot-wrapper"><span class="lbl">Ene</span><label><input type="radio" name="mes" value="Enero" onchange="calc()"><div class="dot"></div></label></div></div><div class="letters-group"><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Feb</span><label><input type="radio" name="mes" value="Febrero" onchange="calc()"><div class="dot"></div></label></div><div class="letter">T</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Mar</span><label><input type="radio" name="mes" value="Marzo" onchange="calc()"><div class="dot"></div></label></div><div class="letter">E</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Abr</span><label><input type="radio" name="mes" value="Abril" onchange="calc()"><div class="dot"></div></label></div><div class="letter">M</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">May</span><label><input type="radio" name="mes" value="Mayo" onchange="calc()"><div class="dot"></div></label></div><div class="letter">P</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Jun</span><label><input type="radio" name="mes" value="Junio" onchange="calc()"><div class="dot"></div></label></div><div class="letter">E</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Jul</span><label><input type="radio" name="mes" value="Julio" onchange="calc()"><div class="dot"></div></label></div><div class="letter">R</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Ago</span><label><input type="radio" name="mes" value="Agosto" onchange="calc()"><div class="dot"></div></label></div><div class="letter">L</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Sep</span><label><input type="radio" name="mes" value="Septiembre" onchange="calc()"><div class="dot"></div></label></div><div class="letter">I</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Oct</span><label><input type="radio" name="mes" value="Octubre" onchange="calc()"><div class="dot"></div></label></div><div class="letter">T</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Nov</span><label><input type="radio" name="mes" value="Noviembre" onchange="calc()"><div class="dot"></div></label></div><div class="letter">E</div></div></div><div class="side-col"><div class="dot-wrapper"><span class="lbl">Dic</span><label><input type="radio" name="mes" value="Diciembre" onchange="calc()"><div class="dot"></div></label></div></div></div>
            <p style="color:#777; font-size:0.6rem; letter-spacing:1px; margin:0;">AÑO (ASAHI)</p>
            <div class="word-row"><div class="letters-group"><div class="letter-col"><div class="dot-wrapper"><span class="lbl">0</span><label><input type="radio" name="anio" value="0" onchange="calc()"><div class="dot"></div></label></div><div class="letter">A</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="5" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">5</span></div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">1</span><label><input type="radio" name="anio" value="1" onchange="calc()"><div class="dot"></div></label></div><div class="letter">S</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="6" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">6</span></div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">2</span><label><input type="radio" name="anio" value="2" onchange="calc()"><div class="dot"></div></label></div><div class="letter">A</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="7" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">7</span></div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">3</span><label><input type="radio" name="anio" value="3" onchange="calc()"><div class="dot"></div></label></div><div class="letter">H</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="8" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">8</span></div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">4</span><label><input type="radio" name="anio" value="4" onchange="calc()"><div class="dot"></div></label></div><div class="letter">I</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="9" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">9</span></div></div></div></div>
            <p class="input-legend">Marca el punto del MES y el punto del AÑO</p>
        </div>

        <div id="lamisafe" class="brand-section">
            <div class="word-row"><div class="side-col"><div class="dot-wrapper"><span class="lbl">Feb</span><label><input type="radio" name="mes" value="Febrero" onchange="calc()"><div class="dot"></div></label></div></div><div class="letters-group"><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Mar</span><label><input type="radio" name="mes" value="Marzo" onchange="calc()"><div class="dot"></div></label></div><div class="letter">L</div><div class="dot-wrapper absolute pos-bot-floating"><label><input type="radio" name="mes" value="Enero" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">Ene</span></div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Abr</span><label><input type="radio" name="mes" value="Abril" onchange="calc()"><div class="dot"></div></label></div><div class="letter">A</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">May</span><label><input type="radio" name="mes" value="Mayo" onchange="calc()"><div class="dot"></div></label></div><div class="letter">M</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Jun</span><label><input type="radio" name="mes" value="Junio" onchange="calc()"><div class="dot"></div></label></div><div class="letter">I</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Jul</span><label><input type="radio" name="mes" value="Julio" onchange="calc()"><div class="dot"></div></label></div><div class="letter">S</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Ago</span><label><input type="radio" name="mes" value="Agosto" onchange="calc()"><div class="dot"></div></label></div><div class="letter">A</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Sep</span><label><input type="radio" name="mes" value="Septiembre" onchange="calc()"><div class="dot"></div></label></div><div class="letter">F</div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">Oct</span><label><input type="radio" name="mes" value="Octubre" onchange="calc()"><div class="dot"></div></label></div><div class="letter">E</div><div class="dot-wrapper absolute pos-bot-floating"><label><input type="radio" name="mes" value="Diciembre" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">Dic</span></div></div></div><div class="side-col"><div class="dot-wrapper"><span class="lbl">Nov</span><label><input type="radio" name="mes" value="Noviembre" onchange="calc()"><div class="dot"></div></label></div></div></div>
            <p style="color:#777; font-size:0.6rem; letter-spacing:1px; margin:0;">AÑO (ASAHI)</p>
            <div class="word-row"><div class="letters-group"><div class="letter-col"><div class="dot-wrapper"><span class="lbl">0</span><label><input type="radio" name="anio" value="0" onchange="calc()"><div class="dot"></div></label></div><div class="letter">A</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="5" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">5</span></div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">1</span><label><input type="radio" name="anio" value="1" onchange="calc()"><div class="dot"></div></label></div><div class="letter">S</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="6" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">6</span></div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">2</span><label><input type="radio" name="anio" value="2" onchange="calc()"><div class="dot"></div></label></div><div class="letter">A</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="7" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">7</span></div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">3</span><label><input type="radio" name="anio" value="3" onchange="calc()"><div class="dot"></div></label></div><div class="letter">H</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="8" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">8</span></div></div><div class="letter-col"><div class="dot-wrapper"><span class="lbl">4</span><label><input type="radio" name="anio" value="4" onchange="calc()"><div class="dot"></div></label></div><div class="letter">I</div><div class="dot-wrapper"><label><input type="radio" name="anio" value="9" onchange="calc()"><div class="dot"></div></label><span class="lbl lbl-bot">9</span></div></div></div></div>
            <p class="input-legend">Marca el punto del MES y el punto del AÑO</p>
        </div>

        <div id="nippon" class="brand-section">
            <div class="nippon-wrapper" id="nipponBoard"></div>
            <button onclick="calcNippon()" class="btn-calc-nippon">CALCULAR</button>
            <p class="input-legend">Marca TODOS los puntos azules (Año) y el punto rojo (Mes)</p>
        </div>

    </div>

    <div id="helpModal" class="modal-overlay">
        <div class="help-box">
            <div class="help-content">
                <h3>GUÍA DE USO</h3>
                <p>Selecciona el fabricante de la luna en las pestañas superiores y marca los puntos tal como aparecen en el cristal del vehículo.</p>
                
                <h4>Funcionamiento General</h4>
                <p>La mayoría de fabricantes usan un sistema de <strong>lectura directa</strong>: un punto indica el MES y otro el AÑO.</p>
                
                <h4>Triplex</h4>
                <p>Usa lógica de Bloques: <br>
                - Puntos simples (Ene-Abr)<br>
                - T(2 puntos) + otro (May-Ago)<br>
                - X(2 puntos) + otro (Sep-Dic)</p>

                <h4>Caso Especial: NIPPON SAFETY</h4>
                <div class="help-note">
                    <strong>¿Por qué tiene botón CALCULAR?</strong><br>
                    Nippon Safety utiliza una Tabla Combinatoria compleja. El año no lo da un solo punto, sino la combinación de varios. Marca todos los puntos visibles.
                </div>
            </div>
            <button class="close-help-btn" onclick="closeHelp()">Cerrar Ayuda</button>
        </div>
    </div>

    <div class="result-box">
        <div class="res-content">
            <div class="res-main" id="res-main">--</div>
            <div class="res-sub" id="res-sub">Selecciona los datos</div>
        </div>
        <button class="help-btn-small" onclick="openHelp()">AYUDA</button>
    </div>

    <script>
        // --- TRIPLEX STATE ---
        let triplexState = { months: [0,0,0,0,0,0,0], year: null };

        // --- NIPPON STATE ---
        const YEAR_TABLE_NIPPON = {
            "A": [1991, 2021], "B": [1992, 2022], "C": [1993, 2023], "D": [1994, 2024],
            "AB": [1995, 2025], "AC": [1996, 2026], "AD": [1997, 2027], "BC": [1998, 2028], "BD": [1999, 2029], "CD": [2000, 2030],
            "AE": [2001], "BE": [2002], "CE": [2003], "DE": [2004], "ABE": [2005], "ACE": [2006], "ADE": [2007], "BCE": [2008], "BDE": [2009], "CDE": [2010],
            "AF": [2011], "BF": [2012], "CF": [2013], "DF": [2014], "ABF": [2015], "ACF": [2016], "ADF": [2017], "BCF": [2018], "BDF": [2019], "CDF": [2020]
        };
        let nipponSel = { m: null, yDots: [] };
        
        const NIPPON_ELEMENTS = [
            { type: 'letter', char: 'N', x: 25, y: 40, rot: -20 }, { type: 'dot', id: 'm1', val: 1, color: 'red', x: 25, y: 30, label: 'ENE', lblPos: 'top' },
            { type: 'letter', char: 'I', x: 35, y: 35, rot: -10 }, { type: 'dot', id: 'm2', val: 2, color: 'red', x: 35, y: 25, label: 'FEB', lblPos: 'top' },
            { type: 'letter', char: 'P', x: 45, y: 32, rot: -5 },  { type: 'dot', id: 'm3', val: 3, color: 'red', x: 45, y: 22, label: 'MAR', lblPos: 'top' },
            { type: 'letter', char: 'P', x: 55, y: 32, rot: 5 },   { type: 'dot', id: 'm4', val: 4, color: 'red', x: 55, y: 22, label: 'ABR', lblPos: 'top' },
            { type: 'letter', char: 'O', x: 65, y: 35, rot: 10 },  { type: 'dot', id: 'm5', val: 5, color: 'red', x: 65, y: 25, label: 'MAY', lblPos: 'top' },
            { type: 'letter', char: 'N', x: 75, y: 40, rot: 20 },  { type: 'dot', id: 'm6', val: 6, color: 'red', x: 75, y: 30, label: 'JUN', lblPos: 'top' },
            { type: 'letter', char: 'S', x: 25, y: 60, rot: 20 },  { type: 'dot', id: 'm7', val: 7, color: 'red', x: 25, y: 70, label: 'JUL', lblPos: 'bot' },
            { type: 'letter', char: 'A', x: 35, y: 65, rot: 10 },  { type: 'dot', id: 'm8', val: 8, color: 'red', x: 35, y: 75, label: 'AGO', lblPos: 'bot' },
            { type: 'letter', char: 'F', x: 45, y: 68, rot: 5 },   { type: 'dot', id: 'm9', val: 9, color: 'red', x: 45, y: 78, label: 'SEP', lblPos: 'bot' },
            { type: 'letter', char: 'E', x: 55, y: 68, rot: -5 },  { type: 'dot', id: 'm10', val: 10, color: 'red', x: 55, y: 78, label: 'OCT', lblPos: 'bot' },
            { type: 'letter', char: 'T', x: 65, y: 65, rot: -10 }, { type: 'dot', id: 'm11', val: 11, color: 'red', x: 65, y: 75, label: 'NOV', lblPos: 'bot' },
            { type: 'letter', char: 'Y', x: 75, y: 60, rot: -20 }, { type: 'dot', id: 'm12', val: 12, color: 'red', x: 75, y: 70, label: 'DIC', lblPos: 'bot' },
            { type: 'dot', id: 'yA', val: 'A', label: 'A', color: 'blue', x: 15, y: 40 },
            { type: 'dot', id: 'yB', val: 'B', label: 'B', color: 'blue', x: 85, y: 40 },
            { type: 'dot', id: 'yC', val: 'C', label: 'C', color: 'blue', x: 15, y: 60 },
            { type: 'dot', id: 'yD', val: 'D', label: 'D', color: 'blue', x: 85, y: 60 },
            { type: 'dot', id: 'yE', val: 'E', label: 'E', color: 'blue', x: 30, y: 56 },
            { type: 'dot', id: 'yF', val: 'F', label: 'F', color: 'blue', x: 70, y: 56 }
        ];

        /* --- GENÉRICO (HYUNDAI STYLE) --- */
        let genState = { yearDigit: 4, leftDots: 0, rightDots: 0 };

        function initGeneric() {
            renderGenDots('left');
            renderGenDots('right');
            document.getElementById('genNumDisplay').textContent = genState.yearDigit;
        }

        function toggleGenYear() {
            genState.yearDigit = (genState.yearDigit + 1) % 10;
            document.getElementById('genNumDisplay').textContent = genState.yearDigit;
            calcGeneric();
        }

        function setGenDots(side, count) {
            if (side === 'left') {
                if (genState.leftDots === count) genState.leftDots = 0;
                else { genState.leftDots = count; genState.rightDots = 0; }
            } else {
                if (genState.rightDots === count) genState.rightDots = 0;
                else { genState.rightDots = count; genState.leftDots = 0; }
            }
            renderGenDots('left');
            renderGenDots('right');
            calcGeneric();
        }

        function renderGenDots(side) {
            const container = document.getElementById(side === 'left' ? 'gen-left-dots' : 'gen-right-dots');
            container.innerHTML = '';
            const activeCount = side === 'left' ? genState.leftDots : genState.rightDots;
            
            for (let i = 1; i <= 6; i++) {
                const dot = document.createElement('div');
                dot.className = 'gen-dot';
                
                // Visualización espejo
                let isActive = false;
                if (side === 'left') {
                    if (i > (6 - activeCount)) isActive = true;
                } else {
                    if (i <= activeCount) isActive = true;
                }
                
                if (isActive) dot.classList.add('active');
                
                let clickCount = side === 'left' ? (7 - i) : i;
                dot.onclick = () => setGenDots(side, clickCount);
                container.appendChild(dot);
            }
        }

        function calcGeneric() {
            const months = ["", "ENERO", "FEBRERO", "MARZO", "ABRIL", "MAYO", "JUNIO", "JULIO", "AGOSTO", "SEPTIEMBRE", "OCTUBRE", "NOVIEMBRE", "DICIEMBRE"];
            let monthIndex = 0;
            
            if (genState.leftDots > 0) {
                monthIndex = 7 - genState.leftDots;
            } else if (genState.rightDots > 0) {
                monthIndex = 13 - genState.rightDots;
            }

            const main = document.getElementById('res-main');
            const sub = document.getElementById('res-sub');

            if (monthIndex > 0) {
                const y = genState.yearDigit;
                const years = `${2000+y} / ${2010+y} / ${2020+y}`;
                main.innerHTML = `<span class="hl">${months[monthIndex]}</span> terminado en <span class="hl">${y}</span>`;
                sub.innerText = `Posibles fechas: ${years}`;
            } else {
                main.innerText = `Año terminado en ${genState.yearDigit}`;
                sub.innerText = "Selecciona puntos para ver el mes";
            }
        }

        // --- TRIPLEX LOGIC ---
        function toggleTriplex(idx, max) {
            const currentVal = triplexState.months[idx];
            // No reset: permite acumular puntos
            let nextVal = currentVal + 1;
            if (nextVal > max) nextVal = 0;
            triplexState.months[idx] = nextVal;
            
            updateTriplexVisuals();
            // No auto-calculate
        }

        function setTriplexYear(val) {
            triplexState.year = (triplexState.year === val) ? null : val;
            updateTriplexVisuals();
            // No auto-calculate
        }

        function updateTriplexVisuals() {
            // Months
            triplexState.months.forEach((count, idx) => {
                const d1 = document.getElementById(`tm-${idx}-1`);
                const d2 = document.getElementById(`tm-${idx}-2`);
                if(d1) d1.classList.remove('active');
                if(d2) d2.classList.remove('active');
                if(count >= 1 && d1) d1.classList.add('active');
                if(count >= 2 && d2) d2.classList.add('active');
            });
            // Years
            for(let i=0; i<=9; i++) {
                const yd = document.getElementById(`ty-${i}`);
                if(yd) {
                    if(triplexState.year === i) yd.classList.add('active');
                    else yd.classList.remove('active');
                }
            }
        }

        function calcTriplexResult() {
            const main = document.getElementById('res-main');
            const sub = document.getElementById('res-sub');
            
            // Lógica Combinatoria 4-4-4
            // T(0), R(1), I(2), P(3), L(4), E(5), X(6)
            const s = triplexState.months;
            let mText = "";

            // Check High Priority (Blocks 2 and 3)
            // Block 3: X has 2 dots
            if (s[6] === 2) {
                if (s[0] >= 1) mText = "OCTUBRE"; // X(2) + T
                else if (s[1] >= 1) mText = "NOVIEMBRE"; // X(2) + R
                else if (s[5] >= 1) mText = "DICIEMBRE"; // X(2) + E (Image implies E is used)
                else mText = "SEPTIEMBRE"; // X(2) Only
            } 
            // Block 2: T has 2 dots
            else if (s[0] === 2) {
                if (s[1] >= 1) mText = "JUNIO"; // T(2) + R
                else if (s[5] >= 1) mText = "JULIO"; // T(2) + E
                else if (s[6] >= 1) mText = "AGOSTO"; // T(2) + X
                else mText = "MAYO"; // T(2) Only
            }
            // Block 1: Single dots
            else {
                if (s[0] === 1) mText = "ENERO";
                else if (s[1] === 1) mText = "FEBRERO";
                else if (s[5] === 1) mText = "MARZO"; // Image says Mar is E?
                else if (s[6] === 1) mText = "ABRIL"; // Image says Apr is X?
            }

            let yText = triplexState.year !== null ? `...${triplexState.year}` : "";
            let decades = "";
            if(triplexState.year !== null) {
                let d = triplexState.year;
                decades = `Posibles fechas: 199${d} / 200${d} / 201${d} / 202${d}`;
            }

            if(mText && yText) {
                main.innerHTML = `<span class="hl">${mText}</span> año <span class="hl">${yText}</span>`;
                sub.innerText = decades;
            } else if (mText) {
                main.innerText = mText;
                sub.innerText = "Falta seleccionar Año";
            } else if (yText) {
                main.innerText = `Año ${yText}`;
                sub.innerText = "Falta seleccionar Mes";
            } else {
                main.innerText = "Combinación Desconocida";
                sub.innerText = "Revisa los puntos (T, R, E, X)";
            }
        }

        // --- APP LOGIC ---
        function openTab(id) {
            document.querySelectorAll('.brand-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            const btns = Array.from(document.querySelectorAll('.tab-btn'));
            const map = ['generic', 'hyundai', 'laminex', 'lamisafe', 'nippon', 'tempalex', 'temperlite', 'triplex'];
            const idx = map.indexOf(id);
            if(idx >= 0 && btns[idx]) btns[idx].classList.add('active');

            if (id === 'nippon') {
                resetCalc();
                renderNippon();
            } else if (id === 'generic') {
                initGeneric();
                calcGeneric();
            } else if (id === 'triplex') {
                resetCalc();
                updateTriplexVisuals();
            } else {
                resetCalc();
            }
        }

        function openHelp() { document.getElementById('helpModal').style.display = 'flex'; }
        function closeHelp() { document.getElementById('helpModal').style.display = 'none'; }

        function resetCalc() {
            document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
            nipponSel = { m: null, yDots: [] };
            triplexState = { months: [0,0,0,0,0,0,0], year: null };
            updateTriplexVisuals();
            document.getElementById('res-main').innerText = "--";
            document.getElementById('res-sub').innerText = "Selecciona los datos";
        }

        function calc() {
            const activeSec = document.querySelector('.brand-section.active');
            if(activeSec.id === 'nippon' || activeSec.id === 'help' || activeSec.id === 'generic' || activeSec.id === 'triplex') return;

            const mInp = activeSec.querySelector('input[name="mes"]:checked');
            const aInp = activeSec.querySelector('input[name="anio"]:checked');
            let mVal = mInp ? mInp.value : null;
            let aVal = aInp ? aInp.value : null;

            const main = document.getElementById('res-main');
            const sub = document.getElementById('res-sub');

            if (mVal && aVal) {
                main.innerHTML = `<span class="hl">${mVal}</span> del año terminado en <span class="hl">${aVal}</span>`;
                let d = parseInt(aVal) % 10;
                if(!isNaN(d)) sub.innerText = `Posibles fechas: 200${d} / 201${d} / 202${d}`;
            } else if (mVal) {
                main.innerText = mVal;
                sub.innerText = "Falta el Año";
            } else if (aVal) {
                main.innerText = `Año ...${aVal}`;
                sub.innerText = "Falta el Mes";
            }
        }

        function renderNippon() {
            const container = document.getElementById('nipponBoard');
            if(!container) return;
            container.innerHTML = '';

            NIPPON_ELEMENTS.forEach(el => {
                const div = document.createElement('div');
                div.className = 'n-elem';
                div.style.position = 'absolute';
                div.style.left = el.x + '%';
                div.style.top = el.y + '%';
                div.style.transform = 'translate(-50%, -50%)';
                
                if (el.type === 'letter') {
                    const span = document.createElement('div');
                    span.className = 'nippon-letter';
                    span.textContent = el.char;
                    span.style.transform = `rotate(${el.rot}deg)`;
                    div.appendChild(span);
                } else if (el.type === 'dot') {
                    const dot = document.createElement('div');
                    dot.className = `n-dot n-dot-${el.color}`;
                    dot.id = el.id;
                    if(el.color === 'blue' && el.label) dot.textContent = el.label;
                    
                    let isSelected = false;
                    if (el.color === 'red') isSelected = (nipponSel.m === el.val);
                    else isSelected = nipponSel.yDots.includes(el.val);
                    
                    if(isSelected) dot.classList.add('selected');
                    
                    if (el.color === 'red' && el.label) {
                        const lbl = document.createElement('div');
                        lbl.className = `n-lbl n-lbl-${el.lblPos}`;
                        lbl.textContent = el.label;
                        div.appendChild(lbl);
                    }

                    dot.onclick = (e) => handleNipponClick(e, el);
                    div.appendChild(dot);
                }
                container.appendChild(div);
            });
        }

        function handleNipponClick(e, el) {
            e.stopPropagation();
            if (el.color === 'red') {
                nipponSel.m = (nipponSel.m === el.val) ? null : el.val;
            } else {
                const idx = nipponSel.yDots.indexOf(el.val);
                if (idx > -1) nipponSel.yDots.splice(idx, 1);
                else nipponSel.yDots.push(el.val);
                nipponSel.yDots.sort();
            }
            renderNippon();
        }

        function calcNippon() {
            const main = document.getElementById('res-main');
            const sub = document.getElementById('res-sub');
            
            if (nipponSel.m === null && nipponSel.yDots.length === 0) return;

            const months = ["", "ENERO", "FEBRERO", "MARZO", "ABRIL", "MAYO", "JUNIO", "JULIO", "AGOSTO", "SEPTIEMBRE", "OCTUBRE", "NOVIEMBRE", "DICIEMBRE"];
            const pattern = nipponSel.yDots.join('');
            const monthText = nipponSel.m ? months[nipponSel.m] : "Mes ?";
            
            let years = YEAR_TABLE_NIPPON[pattern];
            
            if(years) {
                main.innerHTML = `<span style="color:#ef4444">${monthText}</span>`;
                sub.innerHTML = `Fechas: <span style="color:#4ade80; font-weight:bold; font-size:1.1rem;">${years.join(" / ")}</span>`;
            } else {
                if (nipponSel.yDots.length > 0) {
                    main.innerText = "Combinación Inválida";
                    sub.innerText = "Revisa los puntos azules";
                } else {
                    main.innerText = monthText;
                    sub.innerText = "Falta seleccionar Año";
                }
            }
        }
        
        window.addEventListener('resize', () => {
            if(document.getElementById('nippon').classList.contains('active')) renderNippon();
        });

        // Init
        window.onload = function() {
            openTab('generic');
        };
    </script>
</body>
</html>