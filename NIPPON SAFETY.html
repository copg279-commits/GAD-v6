<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NIPPON SAFETY - G.A.D.</title>
    <style>
        :root {
            --bg-color: #1a1a1a; 
            --panel-bg: #252525;
            --text-color: #f0f0f0;
            
            /* Colores Base */
            --dot-off-bg: #333333;       
            --dot-off-border: #666666;   
            
            /* Colores Activos */
            --active-yellow: #ffd700;    
            --active-blue: #00d2ff;      
            --active-border: #ffffff;    
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            margin: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* BARRA SUPERIOR */
        .top-bar {
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
            display: flex;
            justify-content: flex-start;
        }
        .back-btn {
            background: #333;
            color: #ccc;
            border: 1px solid #555;
            padding: 12px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .back-btn:active { transform: scale(0.98); background: #444; color: white; }

        /* CONTENEDOR PRINCIPAL */
        .glass-container {
            background: var(--panel-bg);
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            padding: 20px 0 100px 0; 
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            width: 100%;
            max-width: 800px;
            box-sizing: border-box;
            position: relative;
            min-height: 600px; 
            justify-content: center;
        }

        /* --- DIAGRAMA NIPPON --- */
        .nippon-wrapper {
            position: relative;
            width: 100%;
            height: 480px; /* Altura ajustada para dar aire */
            max-width: 500px;
            margin: 0 auto;
        }

        /* Elementos (Letras y Puntos) */
        .n-elem { 
            position: absolute; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            transform: translate(-50%, -50%); 
            z-index: 20; 
        }

        /* Letras */
        .nippon-letter { 
            font-family: 'Arial Black', sans-serif; 
            font-weight: 900; 
            color: #cc0000; 
            font-size: 2rem; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.6); 
            line-height: 1; 
            pointer-events: none; /* CLAVE: Para que el click pase si se solapan */
            white-space: nowrap;
        }

        /* --- ESTILOS DE LOS PUNTOS (BOTONES) --- */
        .n-dot {
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 50; /* Siempre encima de las letras */
            
            /* Estado Inactivo */
            background-color: var(--dot-off-bg);
            border: 3px solid var(--dot-off-border); 
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }

        /* ESTADO SELECCIONADO - MESES (AMARILLO) */
        .n-dot-red.selected {
            background-color: var(--active-yellow) !important;
            border-color: var(--active-border) !important;
            transform: scale(1.3);
            box-shadow: 0 0 20px var(--active-yellow); 
            color: #000 !important; 
        }

        /* ESTADO SELECCIONADO - AÑOS (AZUL CLARO) */
        .n-dot-blue.selected {
            background-color: var(--active-blue) !important;
            border-color: var(--active-border) !important;
            transform: scale(1.3);
            box-shadow: 0 0 20px var(--active-blue); 
            color: #000 !important; 
        }

        /* Dimensiones específicas */
        .n-dot-red {
            width: 20px; 
            height: 20px;
        }
        
        .n-dot-blue {
            width: 30px; 
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #aaa; 
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* Etiquetas Mes (Ene, Feb...) */
        .n-lbl {
            font-size: 0.6rem;
            color: #aaa;
            font-weight: bold;
            position: absolute;
            white-space: nowrap;
            text-transform: uppercase;
            text-shadow: 1px 1px 2px black;
            pointer-events: none;
        }
        .n-lbl-top { top: -20px; }
        .n-lbl-bot { bottom: -20px; }

        /* Botón Calcular */
        .btn-calc-nippon {
            background: linear-gradient(to right, #2563eb, #3b82f6);
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1rem;
            border: none;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4);
            z-index: 50;
            transition: transform 0.1s;
        }
        .btn-calc-nippon:active { transform: scale(0.95); }

        .input-legend { color: #777; font-size: 0.75rem; text-align: center; margin-top: 15px; font-style: italic; padding: 0 10px; }

        .corner-logo { position: absolute; bottom: 10px; height: 90px; width: auto; opacity: 0.8; pointer-events: none; }
        .logo-left { left: 10px; }
        .logo-right { right: 10px; }

        /* MODAL RESULTADO */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 9999; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-box { background: #222; border: 2px solid #3b82f6; padding: 25px; width: 85%; max-width: 400px; border-radius: 12px; text-align: center; animation: popIn 0.3s; }
        @keyframes popIn { from {transform:scale(0.8);opacity:0;} to {transform:scale(1);opacity:1;} }
        
        .result-content h2 { color: #ccc; font-size: 1rem; text-transform: uppercase; margin-bottom: 10px; }
        .res-modal-main { font-size: 2rem; color: #fff; font-weight: bold; margin: 10px 0; }
        .res-modal-sub { color: #3b82f6; font-size: 1.1rem; margin-bottom: 20px; display: block; }
        .close-btn { width: 100%; background: #d32f2f; color: white; padding: 12px; border: none; border-radius: 6px; font-weight: bold; font-size: 1.1rem; cursor: pointer; text-transform: uppercase; }

        /* RESPONSIVE SCALING */
        @media (max-width: 450px) {
            .nippon-wrapper { transform: scale(0.82); transform-origin: center top; margin-bottom: -50px; }
            .corner-logo { height: 60px; bottom: 10px; }
            .glass-container { min-height: 550px; }
        }
        @media (max-width: 360px) {
            .nippon-wrapper { transform: scale(0.7); margin-bottom: -90px; }
        }
    </style>
</head>
<body>

    <div class="top-bar">
        <a href="index_lunas.html" class="back-btn">
            <span>&#8678;</span> VOLVER AL SELECTOR DE FABRICANTES
        </a>
    </div>

    <div class="glass-container">
        
        <img src="logogad2.png" alt="Logo Izq" class="corner-logo logo-left">
        <img src="logogad.png" alt="Logo Der" class="corner-logo logo-right">

        <div class="nippon-wrapper" id="nipponBoard">
            </div>

        <button onclick="calcNippon()" class="btn-calc-nippon">CALCULAR</button>

        <p class="input-legend">
            Selecciona Mes (Amarillo) y Años (Azul Claro)
        </p>

    </div>

    <div id="resultModal" class="modal-overlay">
        <div class="modal-box">
            <div class="result-content">
                <h2>RESULTADO</h2>
                <div class="res-modal-main" id="res-modal-main">--</div>
                <div class="res-modal-sub" id="res-modal-sub">...</div>
            </div>
            <button class="close-btn" onclick="closeResult()">CERRAR</button>
        </div>
    </div>

    <script>
        // --- CONFIGURACIÓN MATEMÁTICA ESTRICTA ---
        
        const ELEMENTS = [
            // ============================================
            // FILA SUPERIOR (N-I-P-P-O-N)
            // Curvatura Letras Y: 30 -> 23 -> 30
            // Curvatura Puntos Y: 18 -> 11 -> 18 (Exactamente encima)
            // ============================================
            
            // N: X=25
            { type: 'letter', char: 'N', x: 25, y: 30, rot: -20 }, 
            { type: 'dot', id: 'm1', val: 1, color: 'red', x: 25, y: 18, label: 'ENE', lblPos: 'top' },
            
            // I: X=35
            { type: 'letter', char: 'I', x: 35, y: 25, rot: -10 }, 
            { type: 'dot', id: 'm2', val: 2, color: 'red', x: 35, y: 13, label: 'FEB', lblPos: 'top' },
            
            // P: X=45
            { type: 'letter', char: 'P', x: 45, y: 23, rot: -5 },  
            { type: 'dot', id: 'm3', val: 3, color: 'red', x: 45, y: 11, label: 'MAR', lblPos: 'top' },
            
            // P: X=55
            { type: 'letter', char: 'P', x: 55, y: 23, rot: 5 },   
            { type: 'dot', id: 'm4', val: 4, color: 'red', x: 55, y: 11, label: 'ABR', lblPos: 'top' },
            
            // O: X=65
            { type: 'letter', char: 'O', x: 65, y: 25, rot: 10 },  
            { type: 'dot', id: 'm5', val: 5, color: 'red', x: 65, y: 13, label: 'MAY', lblPos: 'top' },
            
            // N: X=75
            { type: 'letter', char: 'N', x: 75, y: 30, rot: 20 },  
            { type: 'dot', id: 'm6', val: 6, color: 'red', x: 75, y: 18, label: 'JUN', lblPos: 'top' },
            
            
            // ============================================
            // FILA INFERIOR (S-A-F-E-T-Y)
            // Curvatura Letras Y: 75 -> 83 -> 75
            // Curvatura Puntos Y: 87 -> 95 -> 87 (Exactamente debajo)
            // ============================================
            
            // S: X=25
            { type: 'letter', char: 'S', x: 25, y: 75, rot: 20 },  
            { type: 'dot', id: 'm7', val: 7, color: 'red', x: 25, y: 87, label: 'JUL', lblPos: 'bot' },
            
            // A: X=35
            { type: 'letter', char: 'A', x: 35, y: 80, rot: 10 },  
            { type: 'dot', id: 'm8', val: 8, color: 'red', x: 35, y: 92, label: 'AGO', lblPos: 'bot' },
            
            // F: X=45
            { type: 'letter', char: 'F', x: 45, y: 83, rot: 5 },   
            { type: 'dot', id: 'm9', val: 9, color: 'red', x: 45, y: 95, label: 'SEP', lblPos: 'bot' },
            
            // E: X=55
            { type: 'letter', char: 'E', x: 55, y: 83, rot: -5 },  
            { type: 'dot', id: 'm10', val: 10, color: 'red', x: 55, y: 95, label: 'OCT', lblPos: 'bot' },
            
            // T: X=65
            { type: 'letter', char: 'T', x: 65, y: 80, rot: -10 }, 
            { type: 'dot', id: 'm11', val: 11, color: 'red', x: 65, y: 92, label: 'NOV', lblPos: 'bot' },
            
            // Y: X=75
            { type: 'letter', char: 'Y', x: 75, y: 75, rot: -20 }, 
            { type: 'dot', id: 'm12', val: 12, color: 'red', x: 75, y: 87, label: 'DIC', lblPos: 'bot' },
            
            // ============================================
            // PUNTOS AÑOS (AZULES)
            // Estrategia: Separación suficiente para no tapar letras al expandirse
            // ============================================
            
            // A (Izquierda de N): X=12 (Alejado 2mm), Y alineado a N (30)
            { type: 'dot', id: 'yA', val: 'A', label: 'A', color: 'blue', x: 12, y: 30 }, 
            
            // B (Derecha de N): X=88 (Alejado 2mm), Y alineado a N (30)
            { type: 'dot', id: 'yB', val: 'B', label: 'B', color: 'blue', x: 88, y: 30 }, 
            
            // C (Izquierda de S): X=12, Y alineado a S (75)
            { type: 'dot', id: 'yC', val: 'C', label: 'C', color: 'blue', x: 12, y: 75 }, 
            
            // D (Derecha de Y): X=88, Y alineado a Y (75)
            { type: 'dot', id: 'yD', val: 'D', label: 'D', color: 'blue', x: 88, y: 75 }, 
            
            // E (Entre S y A):
            // S está en X=25, A está en X=35. Mitad = 30.
            // S Y=75, A Y=80. Hueco está "arriba". 
            // Posición Y=69 centra el punto en el hueco triangular sin tocar letras.
            { type: 'dot', id: 'yE', val: 'E', label: 'E', color: 'blue', x: 30, y: 69 }, 
            
            // F (Entre T y Y):
            // T está en X=65, Y está en X=75. Mitad = 70.
            // Posición Y=69 simétrica a E.
            { type: 'dot', id: 'yF', val: 'F', label: 'F', color: 'blue', x: 70, y: 69 }  
        ];

        // TABLA DE AÑOS
        const YEAR_TABLE = {
            "A": [1991, 2021], "B": [1992, 2022], "C": [1993, 2023], "D": [1994, 2024],
            "AB": [1995, 2025], "AC": [1996, 2026], "AD": [1997, 2027], "BC": [1998, 2028], "BD": [1999, 2029], "CD": [2000, 2030],
            "AE": [2001], "BE": [2002], "CE": [2003], "DE": [2004], "ABE": [2005], "ACE": [2006], "ADE": [2007], "BCE": [2008], "BDE": [2009], "CDE": [2010],
            "AF": [2011], "BF": [2012], "CF": [2013], "DF": [2014], "ABF": [2015], "ACF": [2016], "ADF": [2017], "BCF": [2018], "BDF": [2019], "CDF": [2020]
        };

        // ESTADO
        let state = { m: null, yDots: [] };

        // INIT
        window.onload = () => { renderBoard(); };

        function renderBoard() {
            const container = document.getElementById('nipponBoard');
            container.innerHTML = '';

            ELEMENTS.forEach(el => {
                const div = document.createElement('div');
                div.className = 'n-elem';
                div.style.left = el.x + '%';
                div.style.top = el.y + '%';

                if (el.type === 'letter') {
                    const span = document.createElement('div');
                    span.className = 'nippon-letter';
                    span.textContent = el.char;
                    span.style.transform = `rotate(${el.rot}deg)`;
                    div.appendChild(span);
                } 
                else if (el.type === 'dot') {
                    const dot = document.createElement('div');
                    dot.className = `n-dot n-dot-${el.color}`;
                    if(el.label && el.color === 'blue') dot.textContent = el.label;

                    // Estado seleccionado
                    let isSel = false;
                    if(el.color === 'red') isSel = (state.m === el.val);
                    else isSel = state.yDots.includes(el.val);
                    
                    if(isSel) dot.classList.add('selected');

                    // Click handler
                    dot.onclick = () => handleDotClick(el);

                    // Etiqueta Mes
                    if(el.label && el.color === 'red') {
                        const lbl = document.createElement('div');
                        lbl.className = `n-lbl n-lbl-${el.lblPos}`;
                        lbl.textContent = el.label;
                        div.appendChild(lbl);
                    }

                    div.appendChild(dot);
                }
                container.appendChild(div);
            });
        }

        function handleDotClick(el) {
            if (el.color === 'red') {
                state.m = (state.m === el.val) ? null : el.val;
            } else {
                const idx = state.yDots.indexOf(el.val);
                if(idx > -1) state.yDots.splice(idx, 1);
                else state.yDots.push(el.val);
                state.yDots.sort();
            }
            renderBoard();
        }

        function calcNippon() {
            const months = ["", "ENERO", "FEBRERO", "MARZO", "ABRIL", "MAYO", "JUNIO", "JULIO", "AGOSTO", "SEPTIEMBRE", "OCTUBRE", "NOVIEMBRE", "DICIEMBRE"];
            
            const pattern = state.yDots.join('');
            const mText = state.m ? months[state.m] : "MES ?";
            
            let years = YEAR_TABLE[pattern];
            let subText = "Combinación de puntos inválida";
            
            if (years) {
                subText = `Posibles fechas: ${years.join(" / ")}`;
            } else if (state.yDots.length === 0) {
                subText = "Selecciona puntos para el año";
            }

            showResultModal(mText, subText);
        }

        function showResultModal(mainText, subText) {
            document.getElementById('res-modal-main').innerHTML = mainText;
            document.getElementById('res-modal-sub').innerHTML = subText;
            document.getElementById('resultModal').style.display = 'flex';
        }

        function closeResult() {
            document.getElementById('resultModal').style.display = 'none';
        }

    </script>
</body>
</html>