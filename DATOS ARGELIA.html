<!DOCTYPE html>
<html lang="es">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   Título de tu Página - GAD
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet"/>
  <style>
   body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            overflow-y: auto;
        }
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            text-align: center;
        }
        .gad-logo-header {
            width: 160px; /* Tamaño del logo del index.html */
            height: 160px; /* Tamaño del logo del index.html */
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .main-header {
            background-color: #1d4ed8; /* Color de fondo del index */
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0.5rem 0;
        }
        .gad-logo-header img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        .main-content-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-grow: 1;
            width: 100%;
            padding: 0px;
            box-sizing: border-box;
        }

        /* Estilos del pie de página */
        footer {
            text-align: center;
            width: 100%;
            padding: 1.5rem 0;
            background-color: #e5e7eb;
        }
        
        /* Estilos de los botones de navegación */
        .navigation-buttons-row {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            padding: 1rem 0;
            margin-top: 0.75rem;
            gap: 0.75rem;
        }
        .navigation-button {
            padding: 0.5rem 0.5rem;
            font-size: 1rem;
            flex-grow: 0;
        }
        .yellow-button {
            background-color: #facc15;
            color: #333;
            font-weight: bold;
            padding: 10px 15px;
            border-radius: 8px;
            text-decoration: none;
            transition: background-color 0.2s;
            text-align: center;
        }
        .yellow-button:hover {
            background-color: #eab308;
        }
  </style>
 </head>
 <body class="bg-gray-100">
  <header class="main-header">
   <div class="gad-logo-header">
    <img alt="Logo GAD" class="w-full h-full object-cover block" src="logogad.png"/>
   </div>
  </header>
  <main>
   <div class="p-6 bg-white rounded-lg shadow-md mt-4 w-full max-w-2xl text-center">
    <div class="bg-white shadow-lg rounded-xl p-8 max-w-2xl w-full text-center">
     <h1 class="text-2xl font-bold text-gray-800 mb-6">
      Ingreso Masivo de Licencias Argelia
     </h1>
     <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4">
      <input autofocus="" class="flex-1 p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" id="licenciaInput" placeholder="Número de Licencia (Ej: AL1234567)" type="text"/>
      <input class="flex-1 p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-center" id="fechaInput" type="date"/>
      <button class="w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-md transition duration-200 px-6" onclick="agregarDatos()">
       Añadir
      </button>
     </div>
     <p class="mt-4 text-gray-500 text-sm" id="totalDatos">
      Total de datos a guardar: 0
     </p>
     <div class="mt-4 text-sm font-medium" id="statusMessage">
     </div>
     <button class="mt-6 w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-md transition duration-200" onclick="guardarTodoEnFirebase()">
      Guardar todos los datos
     </button>
    </div>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js">
    </script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js">
    </script>
    <script>
     const firebaseConfig = {
            databaseURL: "https://gad-alicante-f0d56-default-rtdb.europe-west1.firebasedatabase.app"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const licenciasRef = database.ref('licencias_argelia_nuevas');

        let datosTemporales = [];
        const licenciaInput = document.getElementById('licenciaInput');
        const fechaInput = document.getElementById('fechaInput');
        const statusMessage = document.getElementById('statusMessage');
        const totalDatos = document.getElementById('totalDatos');
        const listaDatos = document.getElementById('listaDatos');

        function agregarDatos() {
            const numero = licenciaInput.value.trim().toUpperCase();
            const fecha = fechaInput.value;

            if (numero && fecha) {
                const nuevoDato = {
                    numero: numero,
                    fecha: fecha
                };

                // Verificar si la licencia ya está en la lista temporal
                const existe = datosTemporales.some(d => d.numero === nuevoDato.numero);
                if (existe) {
                    statusMessage.textContent = '❌ Este número de licencia ya ha sido añadido a la lista.';
                    statusMessage.style.color = 'red';
                    return;
                }

                datosTemporales.push(nuevoDato);
                renderizarLista();
                licenciaInput.value = '';
                fechaInput.value = '';
                licenciaInput.focus();
                statusMessage.textContent = '';
            } else {
                statusMessage.textContent = 'Por favor, rellena ambos campos.';
                statusMessage.style.color = 'orange';
            }
        }

        function guardarTodoEnFirebase() {
            if (datosTemporales.length === 0) {
                statusMessage.textContent = 'No hay datos para guardar.';
                statusMessage.style.color = 'orange';
                return;
            }

            statusMessage.textContent = 'Guardando datos... Por favor, espera.';
            statusMessage.style.color = 'gray';

            const actualizaciones = {};
            datosTemporales.forEach(dato => {
                // Ahora usamos el número de licencia como la clave
                actualizaciones[dato.numero] = {
                    numero: dato.numero,
                    fecha: dato.fecha
                };
            });
            
            // Usamos .update() en el nodo principal para añadir sin borrar lo existente
            licenciasRef.update(actualizaciones)
                .then(() => {
                    statusMessage.textContent = `✅ ¡${datosTemporales.length} datos guardados con éxito!`;
                    statusMessage.style.color = 'green';
                    datosTemporales = [];
                    renderizarLista();
                })
                .catch(error => {
                    statusMessage.textContent = '❌ Error al guardar en Firebase: ' + error.message;
                    statusMessage.style.color = 'red';
                });
        }
        
        function renderizarLista() {
            listaDatos.innerHTML = '';
            datosTemporales.forEach((dato, index) => {
                const fila = document.createElement('tr');
                fila.classList.add('bg-white', 'border-b', 'hover:bg-gray-50');

                const celdaNumero = document.createElement('td');
                celdaNumero.classList.add('px-6', 'py-4', 'font-medium', 'text-gray-900', 'whitespace-nowrap');
                celdaNumero.textContent = dato.numero;

                const celdaFecha = document.createElement('td');
                celdaFecha.classList.add('px-6', 'py-4');
                celdaFecha.textContent = dato.fecha;
                
                const celdaAccion = document.createElement('td');
                celdaAccion.classList.add('px-6', 'py-4', 'text-right');
                
                const deleteIcon = document.createElement('span');
                deleteIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500 delete-icon inline-block" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 100 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 112 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" />
                                      </svg>`;
                deleteIcon.onclick = () => eliminarDeLista(index);
                celdaAccion.appendChild(deleteIcon);

                fila.appendChild(celdaNumero);
                fila.appendChild(celdaFecha);
                fila.appendChild(celdaAccion);
                listaDatos.appendChild(fila);
            });
            totalDatos.textContent = `Total de datos a guardar: ${datosTemporales.length}`;
        }

        function eliminarDeLista(index) {
            datosTemporales.splice(index, 1);
            renderizarLista();
        }
        
        licenciaInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                fechaInput.focus();
            }
        });
        
        fechaInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                agregarDatos();
            }
        });
    </script>
   </div>
   <div class="navigation-buttons-row">
    <a class="yellow-button navigation-button w-40" href="index.html">
     Menú Principal
    </a>
    <button class="yellow-button navigation-button w-40" onclick="window.history.back()">
     Atrás
    </button>
   </div>
  </main>
  <footer class="mt-auto text-center py-6 bg-gray-200">
   <div class="flex flex-col items-center">
    <hr class="border-t border-gray-400 w-11/12 max-w-md mx-auto mb-4"/>
    <p class="font-bold">
     GRUPO DE ANÁLISIS DOCUMENTAL
    </p>
    <p class="font-bold">
     POLICÍA LOCAL DE ALICANTE
    </p>
    <p>
     © GAD - Todos los derechos reservados
    </p>
   </div>
  </footer>
 </body>
</html>
